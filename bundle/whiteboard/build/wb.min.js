(function(g,a){var b={cmdWrapperDiv:"commandToolsWrapper",create:function(a){if("#"==a.charAt(0)){var d=a.substring(1,a.length);b.utility.canvasCalcOffset(d);return new b.main(a)}alert("there is a problem with canvas id")},main:function(c){b.main.children=[];b.main.id=0;b.main.uid=0;b.main.canvas=a.querySelector(c);b.main.canid=c.substring(1,c.length);b.main.currentTransform="";b.main.replayObjs=[];b.main.dragMode=!1;b.main.scaleMode=!1;b.main.usrCurrAction="";b.main.currObj="";b.main.textObj=!1;
b.main.action="create";b.wb={};b.wb.sentPack=!1;b.activMouse=new b.mouse;b.activMouse.init()},extend:function(a,b){if("object"==typeof a&&"object"==typeof b){for(var f in b)a[f]=b[f];return a}alert("it seems that the arguments you passed are not object")},transform:function(a,b){a.translate(b.x,b.y);a.rotate(b.theta);a.scale(b.scaleX*(b.flipX?-1:1),b.scaleY*(b.flipY?-1:1))},getStates:function(a){return b.main[a]},setValInMain:function(a,d){return b.main[a]=d},ArrayIndexOf:function(a,b){if(!b||"function"!=
typeof b||!a||!a.length||1>a.length)return-1;for(var f=0;f<a.length;f++)if(b(a[f]))return f;return-1},renderAll:function(a){var d=b.main.children.length;"object"!=typeof a&&(a=b.main.canvas.getContext("2d"));b.clearContext(a);if(d)for(var f=0;f<d;++f)"freeDrawing"==b.main.children[f].type?b.fhdRender(a,b.main.children[f]):b.render(a,b.main.children[f])},clearContext:function(a){var d=b.main.canvas;a.clearRect(0,0,d.width,d.height);return d},deactivateAll:function(){for(var a=b.main.children,d=0,f=
a.length;d<f;d++)a[d].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,b){this.addEventListener("on"+a,b)}}},remove:function(a){var d=b.main.canvas,f=b.ArrayIndexOf(b.main.children,function(b){return b.id==a.id&&(b.mt==a.mt||!0==a.multiuser)});0<=f&&b.main.children.splice(f,1);var f=d.height,k=d.width,d=d.getContext("2d");d.beginPath();d.clearRect(0,0,k,f);d.closePath();b.renderAll()},render:function(a,d,f){a.beginPath();a.save();a.lineWidth=void 0!==a.lineWidth?d.lineWidth:
2;f||b.transform(a,d);a.strokeStyle=void 0!=d.borderColor?d.borderColor:"#000000";"rectangle"==d.type?b.objRect.draw(a,d,f):"line"==d.type?b.objLine.draw(a,d,f):"oval"==d.type?b.objOval.draw(a,d,f):"triangle"==d.type?b.objTri.draw(a,d,f):"text"==d.type&&b.objTxt.draw(a,d,f);d.active&&!f&&(d.drawBorders(a),d.hideCorners||d.drawCorners(a));a.closePath();a.restore()},fhdRender:function(a,d,f){a.save();var k=d.transformMatrix;k&&a.transform(k[0],k[1],k[2],k[3],k[4],k[5]);f||b.transform(a,d);d.overlayFill?
a.fillStyle=d.overlayFill:d.fill&&(a.fillStyle=d.fill);d.stroke&&(a.strokeStyle=d.stroke);a.beginPath();var h;h=k=0;for(var p=-(d.width/2),g=-(d.height/2),m=0,l=d.path.length;m<l;++m)switch(h=d.path[m],h[0]){case "L":k=h[1];h=h[2];a.lineTo(k+p,h+g);break;case "M":k=h[1],h=h[2],a.moveTo(k+p,h+g)}d.fill&&a.fill();d.stroke&&(a.strokeStyle=d.stroke,a.lineWidth=d.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!f&&d.active&&(d.drawBorders(a),d.hideCorners||d.drawCorners(a));a.restore()},makeStackObj:function(a,
b,f,k){return{mt:a,ac:b,x:f,y:k}}};g.vcan=b})(window,document);(function(g,a){var b={tool:"",obj:{},prvObj:"",replayTime:0,sentPackets:0,sentPackDiv:"sentPacket",sentPackDivPS:"sentPacketPS",receivedPackets:0,receivedPackDiv:"receivedNumber",receivedPackDivPS:"receivedNumberPS",uid:0,lt:"",commandToolsWrapperId:"commandToolsWrapper",error:[],view:{},lang:{},system:{},gObj:{},bridge:{},user:{},init:function(){b.vcan=g.vcan;var c=b.vcan;b.canvas=c.create("#canvas");c=c.main.canvas;c.setAttribute("tabindex","0");c.focus();c.onkeydown=b.utility.keyOperation;b.system.setCanvasDimension();
"undefined"!==typeof Storage&&(localStorage.repObjs&&JSON.parse(localStorage.repObjs),g.whBoard=b);this.arrowInit();var d=b.sentPackets;setInterval(function(){null!=a.getElementById(b.sentPackDivPS)&&(d=b.utility.calcPsSentPackets(d),a.getElementById(b.sentPackDiv).innerHTML=b.sentPackets)},1E3)},arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof g.whiteboardPath?g.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=function(){a.arrImgDraw=
!0}},createCommand:function(){if(b.utility.alreadyExistToolBar())return!0;var c=a.createElement("div");c.id=b.commandToolsWrapperId;var d=a.getElementById(vcan.canvasWrapperId);null!=d?a.getElementById("containerWb").insertBefore(c,d):a.getElementById("containerWb").appendChild(c);b.createDiv("t_rectangle","rectangle",c,"tool");b.createDiv("t_line","line",c,"tool");b.createDiv("t_freeDrawing","freeDrawing",c,"tool");b.createDiv("t_oval","oval",c,"tool");b.createDiv("t_triangle","triangle",c,"tool");
b.createDiv("t_text","text",c,"tool");b.createDiv("t_activeall","activeAll",c,"tool");b.createDiv("t_clearall","clearAll",c,"tool");b.createDiv("t_connect","conn",c,"controlCmd coff");b.createDiv("t_assign","assign",c,"controlCmd");b.socketOn=parseInt(wbUser.socketOn);1==b.socketOn&&(b.createDiv("t_connectionoff","connectionOff",c,"controlCmd"),b.createDiv("t_connectionon","connectionOn",c,"controlCmd"),b.utility.setClass("vcanvas","socketon"))},createDiv:function(c,d,f,k){var h=a.createElement("a");
h.href="#";var p=a.createElement("div");p.id=c;"undefined"!=typeof k&&(p.className=k);c=a.createElement("img");c.alt=b.lang.getString(d);c.src="undefined"!=typeof g.whiteboardPath?g.whiteboardPath+"/images/"+d+".png":"/images/"+d+".png";h.appendChild(c);h.title="";h.dataset.title=d;h.className="tooltip";p.appendChild(h);f.appendChild(p);a.getElementById(vcan.canvasWrapperId)},createCanvas:function(){var b=a.createElement("div");b.id=vcan.canvasWrapperId;vcan.canvasWrapperId=b.id;var d=a.createElement("canvas");
d.id="canvas";d.innerHTML="Canvas is missing in your browsers. Please update the latest version of your browser";b.appendChild(d);a.getElementById("containerWb").appendChild(b)},setCanvasDimension:function(a){},objInit:function(a){b.user.connected?("t_replay"==this.parentNode.id?(b.utility.clearAll(!1),b.utility.beforeSend({replayAll:!0})):b.toolInit(this.parentNode.id),"t_replay"!=this.parentNode.id&&"t_clearall"!=this.parentNode.id&&"t_reclaim"!=this.parentNode.id&&"t_assign"!=this.parentNode.id&&
"t_connectionoff"!=this.parentNode.id&&"t_connectionon"!=this.parentNode.id&&(a=(new Date).getTime(),b.lt=this.parentNode.id,a={cmd:this.parentNode.id,mt:a},b.uid++,a.uid=b.uid,vcan.main.replayObjs.push(a),b.utility.beforeSend({repObj:[a]}))):alert(b.lang.getString("askForConnect"))},attachToolFunction:function(c,d){vcan.canvasWrapperId="canvasWrapper";b.createCommand(d);if("undefined"==typeof d){null==a.getElementById("canvas")&&b.createCanvas();var f=b.utility.chkValueInLocalStorage("orginalTeacherId");
b.dataInfo=parseInt(wbUser.dataInfo);f&&1==b.dataInfo&&!b.utility.alreadyExistPacketContainer()&&(b.createPacketContainer(),b.createPacketInfoContainer(),b.utility.initStoredPacketsNumbers())}for(var f=a.getElementById(c).getElementsByTagName("div"),k=0;k<f.length;k++)f[k].getElementsByTagName("a")[0].addEventListener("click",b.objInit)},toolInit:function(a,d,f,k){"object"==typeof b.obj.drawTextObj&&!0==b.obj.drawTextObj.wmode&&vcan.main.canvas.getContext("2d");0<b.vcan.getStates("children").length&&
"t_clearall"!=a&&("undefined"!=typeof f&&"t_replay"==a||b.utility.deActiveFrmDragDrop(),!0!=f&&"t_replay"!=a&&b.vcan.renderAll());b.utility.IsObjEmpty(b.obj.freeDrawObj&&!1==f)||(b.obj.freeDrawObj.freesvg=!1);b.vcan.main.currUserCommand=a+"Init";"t_activeall"==a&&b.utility.t_activeallInit();"t_replay"==a&&("undefined"==typeof f&&vcan.setValInMain("id",0),"undefined"!=typeof k?b.t_replayInit(d,k):b.t_replayInit(d));if("t_clearall"==a){if(!confirm(b.lang.getString("clearAllWarnMessage")))return;b.utility.t_clearallInit();
b.utility.makeDefaultValue();b.utility.beforeSend({clearAll:!0})}"t_assign"==a&&(b.utility.assignRole(),d=localStorage.getItem("toolHeight"),null!=d?b.utility.beforeSend({assignRole:!0,toolHeight:d,socket:b.socketOn}):b.utility.beforeSend({assignRole:!0,socket:b.socketOn}));"t_reclaim"==a&&(b.utility.reclaimRole(),b.utility.sendRequest("reclaimRole",!0));"t_connectionoff"==a&&b.utility.connectionOff();"t_connectionon"==a&&b.utility.connectionOn();"t_activeall"!=a&&"t_replay"!=a&&"t_clearallInit"!=
a&&"t_assign"!=a&&"t_reclaim"!=a&&"t_connectionoff"!=a&&"t_connectionon"!=a&&(b.tool=new b.tool_obj(a),b.utility.attachEventHandlers())},tool_obj:function(a){this.cmd=a;"t_freeDrawing"!=a&&(b.obj.freeDrawObj="");"t_text"!=a&&(b.obj.drawTextObj="");"t_freeDrawing"==a?(b.obj.freeDrawObj=new b.readyFreeHandObj("#424240","3"),b.obj.freeDrawObj.init()):"t_text"==a&&(b.obj.drawTextObj=new b.readyTextObj,b.obj.drawTextObj.init("canvasWrapper"));a=a.slice(2,a.length);b.draw_object(a,b.canvas,this)},t_replayInit:function(a,
d){b.replay=b._replay();b.replay.init(a);"undefined"!=typeof d?b.replay.renderObj(d):b.replay.renderObj()}};g.whBoard=b})(window,document);(function(g){var a=g.whBoard;a.utility={userIds:[],isObjExistRE:function(b){if(0<=a.replay.removeElements.length){var c=a.vcan.ArrayIndexOf(a.replay.removeElements,function(a){return a.id==b.id});if(0<=c)return c}},IsObjEmpty:function(a){for(var c in a)if(a.hasOwnProperty(c))return!1;return!0},stringToNumber:function(a){" "==a[a.length-1]&&(a=a.substring(0,a.length-1));return a=Number(a)},clickOutSidebox:function(a){return 1!=a%2?!0:!1},keyOperation:function(b){var c=(new Date).getTime();if(8==b.keyCode&&
(b=a.vcan,""!=b.main.currObj)){a.canvas.removeObject(b.main.currObj);var d=b.extend({},b.main.currObj),d=b.extend(d,{mt:c,func:"remove",usrCurrAction:"delete",lastElement:!0});b.main.replayObjs.push(d);b.main.currObj=""}},attachEventHandlers:function(){a.canvas.bind("mousedown",a.utility.ev_canvas);a.canvas.bind("mousemove",a.utility.ev_canvas);a.canvas.bind("mouseup",a.utility.ev_canvas)},t_clearallInit:function(){a.utility.clearAll(!0)},clearAll:function(b,c){a.uid=0;a.lt="";for(var d=a.vcan;0<
d.main.children.length;)a.canvas.removeObject(d.main.children[0]);!0==b&&d.main.replayObjs.splice(0,d.main.replayObjs.length);void 0!=a.replay&&(a.replay.objNo=0);"move"==d.getStates("action")&&d.setValInMain("action","create");d=document.getElementById("sendPackCont");if(null!=d){var f=d.getElementsByClassName("numbers");if(0<f.length)for(d=0;d<f.length;d++)f[d].innerHTML=0}"undefined"==typeof c&&(a.sentPackets=0,a.receivedPackets=0);d=document.getElementById("sentMsgInfo");null!=d&&(d.innerHTML=
"");d=document.getElementById("rcvdMsgInfo");null!=d&&(d.innerHTML="");f=document.getElementsByClassName("textBoxContainer");for(d=0;d<f.length;d++)f[d].parentNode.removeChild(f[d])},deActiveFrmDragDrop:function(){var b=a.vcan,c=b.main.children;if("move"==b.getStates("action")){b.setValInMain("action","create");for(b=0;b<c.length;b++)c[b].dragDrop(!1),c[b].setActive(!1);return!0}return!1},getOffset:function(a){for(var c=a.target,d=y=0;c&&!isNaN(c.offsetLeft)&&!isNaN(c.offsetTop);)d+=c.offsetLeft-
c.scrollLeft,y+=c.offsetTop-c.scrollTop,c=c.offsetParent;d=a.clientX-d;y=a.clientY-y;return{x:d,y:y}},ev_canvas:function(b){var c=a.vcan.utility.getReltivePoint(b);b.currX=c.x;b.currY=c.y;if(c=a.tool[b.type])return c(b),this.ev_canvas},t_activeallInit:function(){var b=a.vcan,c=b.getStates("children");if(1<=c.length)for(b.setValInMain("action","move"),b=0;b<c.length;b++)c[b].dragDrop(!0)},drawArrowImg:function(b,c){var d=a.vcan.main.canvas.getContext("2d");d.clearRect(0,0,a.vcan.main.canvas.width,
a.vcan.main.canvas.height);vcan.renderAll();d.save();d.beginPath();d.translate(c.mp.x,c.mp.y);d.drawImage(b,-3,-3,18,24);d.closePath();d.restore()},calcPsSentPackets:function(b){if(a.utility.chkValueInLocalStorage("orginalTeacherId"))return b=a.sentPackets-b,0>b&&(b=0),document.getElementById(null!=a.sentPackDivPS)&&(document.getElementById(a.sentPackDivPS).innerHTML=b),a.sentPackets},calcPsRecvdPackets:function(b){b=a.receivedPackets-b;0>b&&(b=0);null!=document.getElementById(a.receivedPackDivPS)&&
(document.getElementById(a.receivedPackDivPS).innerHTML=b);return a.receivedPackets},initStoredPacketsNumbers:function(){if(a.utility.chkValueInLocalStorage("orginalTeacherId")){if(localStorage.sentPackets){var b=JSON.parse(localStorage.sentPackets);a.sentPackets=b;null!=document.getElementById(a.sentPackDiv)&&(document.getElementById(a.sentPackDiv).innerHTML=b)}localStorage.receivedPackets&&(a.receivedPackets=JSON.parse(localStorage.receivedPackets),null!=document.getElementById(a.receivedPackDiv)&&
(document.getElementById(a.receivedPackDiv).innerHTML=a.receivedPackets))}},updateSentPackets:function(b){1==a.dataInfo&&a.utility.chkValueInLocalStorage("orginalTeacherId")&&(a.sentPackets+=JSON.stringify(b).length,null!=document.getElementById(a.sentPackDiv)&&(document.getElementById(a.sentPackDiv).innerHTML=a.sentPackets))},assignRole:function(b){a.tool="";"move"==vcan.main.action&&a.utility.deActiveFrmDragDrop();if("undefined"!=typeof b){if(null!=localStorage.getItem("reclaim")){var c=document.getElementById(a.commandToolsWrapperId);
c.parentNode.removeChild(c);localStorage.removeItem("reclaim")}g.whBoard.attachToolFunction(vcan.cmdWrapperDiv,!0);(a.hasOwnProperty("canvasDisable")||a.canvasDisable)&&a.utility.toolWrapperDisable();localStorage.setItem("teacherId",b);a.utility.makeCanvasEnable()}else{c=document.getElementById(a.commandToolsWrapperId);if(null!=c)for(;c.hasChildNodes();)c.removeChild(c.lastChild);a.utility.makeCanvasDisable();"undefined"!=typeof localStorage.orginalTeacherId?(a.utility.createReclaimButton(c),localStorage.setItem("reclaim",
!0)):null!=c&&c.parentNode.removeChild(c);localStorage.removeItem("teacherId")}},reclaimRole:function(){a.tool="";"move"==vcan.main.action&&a.utility.deActiveFrmDragDrop();a.utility.removeToolBox();g.whBoard.attachToolFunction(vcan.cmdWrapperDiv,!0);localStorage.teacherId=localStorage.orginalTeacherId;"undefined"!=typeof localStorage.reclaim&&localStorage.removeItem("reclaim");a.utility.makeCanvasEnable()},connectionOff:function(){cthis.isInitiator=!1;cthis.pc=[];cthis.cn=0;cthis.isStarted=!1;cthis.byCommand=
!0;io.disconnect()},connectionOn:function(){io.wsconnect()},dispQueuePacket:function(b){(null!=localStorage.getItem("teacherId")||null!=localStorage.getItem("orginalTeacherId")&&a.utility.chkValueInLocalStorage("reclaim"))&&a.utility.toolWrapperEnable();a.utility.isUserConnected(a.clientLen);a.drawMode=!1;null!=localStorage.getItem("teacherId")&&a.user.connected&&a.utility.makeCanvasEnable();0<a.gObj.packQueue.length&&(g.whBoard.vcan.main.replayObjs=a.gObj.packQueue,a.gObj.packQueue=[],a.toolInit("t_replay",
"fromBrowser",!0,a.utility.dispQueuePacket))},updateRcvdInformation:function(a){var c=document.getElementById("rcvdMsgInfo");if(null!=c){var d="",f;for(f in a)d+=f+" : "+a[f]+" <br />";c.innerHTML=d}},makeCanvasDisable:function(){var a=vcan.main.canvas;a.style.position="relative";a.style.pointerEvents="none"},makeCanvasEnable:function(){null==localStorage.getItem("teacherId")||a.hasOwnProperty("canvasDisable")&&a.canvasDisable||(vcan.main.canvas.style.pointerEvents="visible")},removeToolBox:function(){var a=
document.getElementById(vcan.cmdWrapperDiv);a.parentNode.removeChild(a)},createReclaimButton:function(b){a.createDiv("t_reclaim","reclaim",b);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",a.objInit)},chkValueInLocalStorage:function(a){return null===localStorage.getItem(a)?!1:localStorage[a]},uniqueArrOfObjsToStudent:function(){var b="";a.gObj.replayObjs=[];for(var c=0;c<vcan.main.replayObjs.length;c++)b=vcan.extend({},vcan.main.replayObjs[c]),a.gObj.replayObjs.push(b)},
uniqueArrOfObjsToTeacher:function(){vcan.main.replayObjs=[];for(var b="",c=0;c<a.gObj.replayObjs.length;c++)b=vcan.extend({},a.gObj.replayObjs[c]),vcan.main.replayObjs.push(b)},makeDefaultValue:function(){a.gObj.myrepObj=[];a.gObj.replayObjs=[];a.gObj.rcvdPackId=0;a.gObj.displayedObjId=0;a.gObj.packQueue=[];a.uid=0;var b=a.utility.chkValueInLocalStorage("teacherId"),c=a.utility.chkValueInLocalStorage("orginalTeacherId"),d=a.utility.chkValueInLocalStorage("wbrtcMsg"),f=a.utility.chkValueInLocalStorage("canvasDrwMsg"),
k=a.utility.chkValueInLocalStorage("toolHeight");localStorage.clear();b&&localStorage.setItem("teacherId",b);c&&localStorage.setItem("orginalTeacherId",c);d&&localStorage.setItem("wbrtcMsg",d);f&&localStorage.setItem("canvasDrwMsg",f);k&&localStorage.setItem("toolHeight",k);"undefined"!=typeof vcan.objTxt&&vcan.objTxt.removeTextNode();"undefined"!=typeof vcan.main.currentTransform&&(vcan.main.currentTransform="")},setOrginalTeacherContent:function(b){localStorage.setItem("teacherId",a.gObj.uid);g.whBoard.view.canvasDrawMsg("Canvas");
localStorage.setItem("canvasDrwMsg",!0);a.utility.alreadyExistPacketContainer()||1!=parseInt(wbUser.dataInfo,10)||(a.createPacketContainer(),a.createPacketInfoContainer(),a.utility.initStoredPacketsNumbers());localStorage.setItem("orginalTeacherId",a.gObj.uid)},isSystemCompatible:function(){if(0<g.whBoard.error.length)for(var b=0;b<g.whBoard.error.length;b++){var c=g.whBoard.error[b];c.hasOwnProperty("msg")&&a.view.displayMessage(c.msg,c.id,c.className)}},initDefaultInfo:function(b,c){var d=b.message.checkUser.e.clientLen,
f=b.message.checkUser.e.newUser;"t"==c?null==localStorage.getItem("orginalTeacherId")&&(a.utility.setOrginalTeacherContent(b),g.whBoard.attachToolFunction(vcan.cmdWrapperDiv,!0)):"s"==c&&null==f&&(vcan.studentId=wbUser.id,null==localStorage.getItem("studentId")&&localStorage.setItem("studentId",wbUser.id));1==d?(a.gObj.video.init(),a.gObj.video.isInitiator=!0,vcan.oneExecuted=!1):2<=d&&null==f&&(console.log("browser number "+d),2<d&&alert("there may be the problem because of user is more than 2"),
a.utility.beforeSend({videoInt:!0}),a.utility.beforeSend({isChannelReady:!0,memberAdded:!0}),vcan.oneExecuted=!1,a.gObj.video.init())},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(b){a.gObj.virtualWindow=!0;var c=document.createElement("div");a.utility.removeVirtualWindow("virtualWindow");c.setAttribute("id","virtualWindow");c.style.width=b.width+
"px";if("undefined"!=typeof assignRoleAtStudent)var d=0;else d=parseInt(localStorage.getItem("toolHeight")),d=null!=d?d:0;null!=localStorage.getItem("orginalTeacherId")?c.style.height=b.height+d+"px":null!=localStorage.getItem("teacherId")?c.style.height=b.height+"px":c.style.height=b.height-d+"px";b=document.getElementById("containerWb");b.insertBefore(c,b.firstChild)},removeVirtualWindow:function(b){b=document.getElementById(b);null!=b&&(a.gObj.virtualWindow=!1,b.parentNode.removeChild(b))},getWideValueAppliedByCss:function(a,
c){var d=document.getElementById(a);if(null!=d){var f=g.getComputedStyle(d);if("undefined"!=typeof f.marginTop){var k=parseInt(f.marginTop.match(/\d+/));null==k&&(k=0)}return d.clientHeight+k}return!1},isNumber:function(a){return isNaN(+a)?!1:+a},setCommandToolHeights:function(a,c){var d=document.getElementById("virtualWindow");if(null!=d){var f=parseInt(d.style.height.match(/\d+/));d.style.height="decrement"==c?f-parseInt(a)+"px":f+parseInt(a)+"px"}},setClass:function(a,c){var d=document.getElementById(a),
f=d.classList,k="";0<f.length&&(k=2>k.length?f[0]+" ":f.join(" ")+" ");d.setAttribute("class",k+c)},isUserConnected:function(b){1<b&&localStorage.getItem("otherRole")&&(a.user.connected=!0)},isUserConnected_old:function(b){1<b&&(a.user.connected=!0)},setStyleUserConnetion:function(a,c,d){a=document.getElementsByClassName(a)[0];null!=a&&a.setAttribute("class",c+" controlCmd")},existUserLikeMe:function(b){if(b.fromUser.userid!=wbUser.id){if(b.message.checkUser.hasOwnProperty("role")){var c=b.message.checkUser.role;
if(c){if(null==localStorage.getItem("otherRole")){var d=[];if(c!=a.gObj.uRole)d.push(c);else return existUser=!0}else d=JSON.parse(localStorage.getItem("otherRole")),-1==d.indexOf(c)&&d.push(c);"undefined"!=typeof d&&(localStorage.setItem("otherRole",JSON.stringify(d)),console.log("Other Browser "+c+" "+b.fromUser.userid))}return a.gObj.uRole==c?!0:!1}}else{if("undefined"!=typeof existUser)return!0;b=JSON.parse(localStorage.getItem("otherRole"));if(null!=b){for(c=0;c<b.length;c++)if(a.gObj.uRole==
b[c])return!0;return!1}}},existUserWithSameId:function(b){this.userIds.push(b.fromUser.userid);if(1<this.userIds.length&&a.utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable:function(b){a.utility.isUserConnected(b);a.user.connected&&(null==localStorage.getItem("repObjs")&&(a.utility.toolWrapperEnable(),null!=vcan.main.canvas&&a.utility.makeCanvasEnable()),a.utility.setStyleUserConnetion("coff","con"))},displayCanvas:function(){g.whBoard.attachToolFunction(vcan.cmdWrapperDiv);
g.whBoard.init();a.utility.makeCanvasDisable();a.utility.toolWrapperDisable()},initAll:function(b){null!=localStorage.getItem("teacherId")&&a.utility.makeCanvasDisable();b=a.system.measureResoultion({width:g.outerWidth,height:g.innerHeight});var c=a.utility.getWideValueAppliedByCss("commandToolsWrapper");!1!=c?a.utility.beforeSend({virtualWindow:{shareBrowserWidth:!0,browserRes:b,toolHeight:c,role:wbUser.role}}):a.utility.beforeSend({virtualWindow:{shareBrowserWidth:!0,browserRes:b,role:wbUser.role}})},
alreadyExistToolBar:function(){var a=document.getElementById("t_rectangle");if(null!=a)return 8<=a.parentNode.getElementsByClassName("tool").length?!0:!1},alreadyExistPacketContainer:function(){var a=document.getElementById("packetContainer"),c=document.getElementById("informationCont");return 2<=a.getElementsByTagName("div").length||1<=c.getElementsByTagName("div").length?!0:!1},toolWrapperDisable:function(){var a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="none")},
toolWrapperEnable:function(){var a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="visible")},replayFromLocalStroage:function(){if("undefined"!==typeof Storage)if(null!=localStorage.getItem("repObjs")){var b=JSON.parse(localStorage.repObjs);a.vcan.main.replayObjs=b;a.utility.clearAll(!1,"dontClear");a.gObj.replayObjs=a.gObj.replayObjs.concat(b);0<b.length&&(a.uid=b[b.length-1].uid,a.gObj.rcvdPackId=a.uid,a.toolInit("t_replay","fromBrowser",!0,a.utility.dispQueuePacket))}else a.utility.toolWrapperEnable()},
shareVideoInformation:function(b,c){a.utility.isUserConnected(b.message.length);a.user.connected&&a.utility.setStyleUserConnetion("coff","con");"undefined"!=typeof vcan.teacher||c||a.utility.makeCanvasDisable();a.utility.initDefaultInfo(b,wbUser.role);var d=a.system.measureResoultion({width:g.outerWidth,height:g.innerHeight}),f=a.utility.getWideValueAppliedByCss("commandToolsWrapper");!1!=f?a.utility.beforeSend({virtualWindow:{shareBrowserWidth:!0,browserRes:d,toolHeight:f}}):a.utility.beforeSend({virtualWindow:{shareBrowserWidth:!0,
browserRes:d}})},setUserStatus:function(b,c){b||c?a.utility.setClass("vcanvas","teacher"):(a.utility.removeToolBox(),a.utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(){"undefined"!=typeof localStorage.teacherId&&null==localStorage.getItem("canvasDrwMsg")&&(g.whBoard.view.canvasDrawMsg("Canvas"),g.whBoard.view.drawLabel("drawArea"),localStorage.canvasDrwMsg=!0)},removeOtherUserExist:function(b){"t"==b?null!=localStorage.getItem("studentId")&&localStorage.removeItem("studentId"):
"s"==b&&null!=localStorage.getItem("orginalTeacherId")&&(localStorage.removeItem("orginalTeacherId"),null!=localStorage.getItem("teacherId")&&localStorage.removeItem("teacherId"),null!=localStorage.getItem("reclaim")&&localStorage.removeItem("reclaim"),a.utility.removeToolBox())},canvasEnabelWhenRefresh:function(){null!=localStorage.getItem("teacherId")&&a.utility.makeCanvasEnable()},arrayContainsSameValue:function(a,c){for(var d=0;d<c.length;d++)if(c[d]!==a)return!1;return!0},actionAfterRemovedUser:function(){a.utility.makeCanvasDisable();
a.utility.setStyleUserConnetion("con","coff");a.utility.removeVirtualWindow("virtualWindow");a.user.connected=!1;localStorage.removeItem("otherRole");"undefined"!=typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(b,c){a.utility.beforeSend({reclaimRole:!0})},updateSentInformation:function(b,c){if(a.utility.chkValueInLocalStorage("orginalTeacherId")){var d=JSON.parse(b),d="undefined"!=typeof c?d:d.repObj[0],f="",k;for(k in d)f+=k+" : "+d[k]+" <br />";
null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=f)}},beforeSend:function(b){var c=JSON.stringify(b);b.hasOwnProperty("createArrow")?"undefined"==typeof optimizObj?optimizObj=optimization():optimizObj.sendPacketWithOptimization(c,io.sock.readyState,100):(a.sentPackets+=c.length,1==io.sock.readyState&&io.send(b),JSON.parse(c).hasOwnProperty("repObj")&&a.utility.updateSentInformation(c));localStorage.sentPackets=a.sentPackets},checkCanvasHasParents:function(){for(var a=
document.getElementById("vcanvas");"BODY"!=a.parentNode.tagName;)"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0"),a=a.parentNode;"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0")},lockCanvas:function(){if(g.earlierWidth!=g.innerWidth&&(a.canvasDisable=!0,a.utility.makeCanvasDisable(),a.utility.toolWrapperDisable(),null==document.getElementById("divForReloadMsg"))){var b=null!=localStorage.getItem("teacherId")?"msgForReload":"msgStudentForReload";g.whBoard.view.displayMsgBox("divForReloadMsg",
b);g.earlierWidth=g.innerWidth}},getElementRightOffSet:function(a){var c=20;null!=a.parentNode&&(a=a.parentNode,c=vcan.utility.getElementOffset(a),c=g.innerWidth-(a.clientWidth+(c.x-0)));return c}}})(window);(function(g){g.whBoard.lang.message={notSupportCanvas:'This browser does not support Canvas. Please update your browser with the latest versionFor more information about Canvas, click on the link given here <a href="http://en.wikipedia.org/wiki/Canvas_element/">Canvas</a>',notSupportGetUserMedia:'The browser does not support getUserMedia for webRtc. Please update your browser with the latest version For more information about getUuserMedia, click on the link given here <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">getUserMedia</a>',
notSupportPeerConnect:'The browser is unable to create Peer Connection object for WebRtc Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',notSupportWebSocket:'This browser does not support WebSocket. Please update your browser with the latest version. For more information about WebSocket, click on the link given here <a href="http://www.websocket.org/">WebSocket</a>.',notSupportWebRtc:'This browser does not support WebRTC. Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',
line:"Line",rectangle:"Rectangle",triangle:"Triangle",oval:"Oval",assign:"Assign",reclaim:"Reclaim",freeDrawing:"Free Drawing",text:"Text",replay:"Replay",activeAll:"Active All",clearAll:"Clear All",connectionOff:"Connection Off",connectionOn:"Connection On",drawArea:"Draw Area",totRcvdPackets:"Total Received Packets",perSecRcvdData:"Per Second Recevied Packet",totSentPackets:"Total Sent Packets",perSecSentPacket:"Per Second Sent Packets",perSecond:"Per Second",sentPackets:"Sent <br/><span>Packets</span>",
receviedPackets:"Received <br/><span>Pacekts</span>",total:"Total",dataDetails:"Data Details",sentMessageInfo:"Sent Message <br/><span>Information</span>",receivedMessageInfo:"Received Message <br/><span>information</span>",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your microphone and camera with other users',wbrtcMsgChrome:"You can click on deny button for not sharing your microphone and camera with other users.or click on allow button to share your microphone and camera with other users.",
canvasDrawMsg:"You can click on any tool to draw object with a mouse click, mouse move and mouse up in the Draw Area",clearAllWarnMessage:"Would you like to clear all what you have drawn on the whiteboard, Once you clear the whiteboard, you will never get those drawn objects back.",con:"connection on",cof:"connection off",askForConnect:"You will be able to perform this action only when other user get connected",msgForReload:"You will be unable to draw the objects after resizing the window. <br />  So, please reload the page for drawing. ",
msgStudentForReload:"After resizing the window, there can be a problem over the drawn objects, <br />  So, please realod the page for better results ",reload:"Reload"}})(window);(function(g){g.whBoard.lang.getString=function(a){return g.whBoard.lang.message[a]}})(window);(function(g){whBoard=g.whBoard;whBoard.view.msgBoxClass="msgBox";whBoard.view.window={};whBoard.view.virtualWindow={};whBoard.view.displayMessage=function(a,b,c,d,f){a="undefined"==typeof f?whBoard.view.createMsgBox(a,b,c):whBoard.view.createMsgBox(a,b,c,f);b=document.getElementById("vcanvas");"undefined"!=typeof d?document.getElementById(d).appendChild(a):b.insertBefore(a,b.childNodes[0])};whBoard.view.customCreateElement=function(a,b,c){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);
"undefined"!=typeof c&&(a.className=c);return a};whBoard.view.createMsgBox=function(a,b,c,d){var f=whBoard.view.customCreateElement("div",b,c);"undefined"==typeof d&&(c=whBoard.view.customCreateElement("div",b+"img",c+"img"),f.appendChild(c));b=whBoard.view.customCreateElement("p",b+"Para");b.innerHTML=a;f.appendChild(b);return f};whBoard.view.disappearBox=function(a){a=document.getElementsByClassName(whBoard.view.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])};whBoard.view.multiMediaMsg=
function(a){if("Firefox"==whBoard.system.mybrowser.name){var b=whBoard.lang.getString("wbrtcMsgFireFox");whBoard.view.displayMessage(b,"fireFoxWebrtcCont",whBoard.view.msgBoxClass+a)}else"Chrome"==whBoard.system.mybrowser.name&&(b=whBoard.lang.getString("wbrtcMsgChrome"),whBoard.view.displayMessage(b,"chormeWebrtcCont",whBoard.view.msgBoxClass+a))};whBoard.view.canvasDrawMsg=function(a){document.getElementById("vcanvas").className="canvasMsgBoxParent";if("Firefox"==whBoard.system.mybrowser.name){var b=
whBoard.lang.getString("canvasDrawMsg");whBoard.view.displayMessage(b,"canvasDrawMsgContFirefox",whBoard.view.msgBoxClass+a,"containerWb")}else"Chrome"==whBoard.system.mybrowser.name&&(b=whBoard.lang.getString("canvasDrawMsg"),whBoard.view.displayMessage(b,"canvasDrawMsgContChrome",whBoard.view.msgBoxClass+a,"containerWb"))};g.whBoard.view.drawLabel=function(a){var b=whBoard.lang.getString("drawArea");whBoard.view.displayMessage(b,"canvasDrawArea",whBoard.view.msgBoxClass+a,"containerWb",!1)};g.whBoard.view.displayMsgBox=
function(a,b){var c=whBoard.view.customCreateElement("div",a),d=whBoard.view.customCreateElement("p",a+"Para");d.innerHTML=whBoard.lang.getString(b);c.appendChild(d);d=whBoard.view.customCreateElement("a",a+"Anchor");d.href=g.location;d.innerHTML=whBoard.lang.getString("reload");d.onclick=function(){g.location.reload()};c.appendChild(d);d=document.getElementById("vcanvas");d.parentNode.insertBefore(c,d)};g.whBoard.view.displayServerError=function(a,b){var c=whBoard.view.customCreateElement("div",
a);c.innerHTML=b;var d=document.getElementById("vcanvas");d.parentNode.insertBefore(c,d)};g.whBoard.view.removeElement=function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)};count=0;whBoard.view.window.resizeFinished=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();whBoard.view.window.resize=function(){var a=whBoard.system.measureResoultion({width:g.innerWidth,height:g.innerHeight}),b=document.getElementById("vcanvas"),c=whBoard.utility.getElementRightOffSet(b);
a.width-=c;b.style.width=a.width+"px";vcan.renderAll();"undefined"==typeof lastresizetime&&(lastresizetime=(new Date).getTime(),whBoard.utility.beforeSend({virtualWindow:{resizeWindow:a}}));presentresizetime=(new Date).getTime();500<=presentresizetime-lastresizetime&&(whBoard.utility.beforeSend({virtualWindow:{resizeWindow:a}}),lastresizetime=(new Date).getTime(),console.log("send request "+count));whBoard.view.window.resizeFinished(function(){whBoard.utility.beforeSend({virtualWindow:{resizeWindow:a}})},
500)};whBoard.view.virtualWindow.manupulation=function(a){var b=a.message.virtualWindow;if(b.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&whBoard.utility.removeVirtualWindow("virtualWindow");else if(b.hasOwnProperty("resizeWindow"))if(myResolution=whBoard.system.measureResoultion({width:g.outerWidth,height:g.innerHeight}),a.fromUser.userid!=wbUser.id){var c=b.resizeWindow;otherBrowser=c;c.width<myResolution.width?whBoard.utility.createVirtualWindow(c):c.width==myResolution.width&&
whBoard.utility.removeVirtualWindow("virtualWindow")}else"undefined"!=typeof otherBrowser&&(myResolution.width<otherBrowser.width?(whBoard.utility.beforeSend({virtualWindow:{resizeWindow:myResolution}}),whBoard.utility.removeVirtualWindow("virtualWindow")):myResolution.width>otherBrowser.width?(whBoard.utility.createVirtualWindow(otherBrowser),whBoard.utility.beforeSend({virtualWindow:{removeVirtualWindow:!0}})):myResolution.width==otherBrowser.width&&whBoard.utility.removeVirtualWindow("virtualWindow"));
else b.hasOwnProperty("createVirtualWindow")?(b.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",b.toolHeight),a.fromUser.userid!=wbUser.id&&whBoard.utility.createVirtualWindow(b.createVirtualWindow)):b.hasOwnProperty("shareBrowserWidth")&&(b.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",b.toolHeight),null!=localStorage.getItem("teacherId")&&(c=whBoard.utility.getWideValueAppliedByCss("commandToolsWrapper"),localStorage.setItem("toolHeight",c)),a.fromUser.userid!=
wbUser.id?(null!=localStorage.getItem("teacherId")&&whBoard.utility.makeCanvasEnable(),otherBrowser=b.browserRes):myBrowser=whBoard.system.measureResoultion({width:g.outerWidth,height:g.innerHeight}),"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>otherBrowser.width?whBoard.gObj.virtualWindow||(whBoard.utility.createVirtualWindow(otherBrowser),whBoard.gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!whBoard.gObj.virtualWindow&&(a=document.getElementById("vcanvas"),
a=whBoard.utility.getElementRightOffSet(a),null!=localStorage.getItem("teacherId")?whBoard.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a,toolHeight:c}}):whBoard.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}}))))}})(window);(function(g){whBoard.system.wbRtc={};whBoard.system.wbRtc.className="webrtcCont";whBoard.system.mybrowser={};whBoard.system.mybrowser.detection=function(){var a=navigator.userAgent,b,f=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(f[1]))return b=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],"IE "+(b[1]||"");f=f[2]?[f[1],f[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(b=a.match(/version\/([\.\d]+)/i))&&(f[2]=b[1]);return f};whBoard.system.isCanvasSupport=
function(a,b,f){"MSIE"==b?9!=f&&whBoard.error.push({msg:whBoard.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"}):g.CanvasRenderingContext2D||whBoard.error.push({msg:whBoard.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"})};whBoard.system.isWebRtcSupport=function(a,b,f){"Firefox"==b?a.mozGetUserMedia?(whBoard.system.wbRtc.userMedia=!0,g.mozRTCPeerConnection?whBoard.system.wbRtc.peerCon=!0:whBoard.error.push({msg:whBoard.lang.getString("notSupportPeerConnect"),
id:"errorPeerConnect",className:"error"})):whBoard.error.push({msg:whBoard.lang.getString("notSupportGetUserMedia"),id:"errorGetUserMedia",className:"error"}):"Chrome"==b||"Safari"==b?a.webkitGetUserMedia?(whBoard.system.wbRtc.userMedia=!0,g.webkitRTCPeerConnection?whBoard.system.wbRtc.peerCon=!0:whBoard.error.push({msg:whBoard.lang.getString("notSupportPeerConnect"),id:"errorPeerConnect",className:"error"})):whBoard.error.push({msg:whBoard.lang.getString("notSupportGetUserMedia"),id:"errorGetUserMedia",
className:"error"}):"MSIE"==b&&9>=f&&whBoard.error.push({msg:whBoard.lang.getString("notSupportWebRtc"),id:"errorWebRtc",className:"error"})};whBoard.system.isWebSocketSupport=function(a,b,f){whBoard.system.webSocket={};"undefined"==typeof g.WebSocket||"function"!=typeof g.WebSocket&&"object"!=typeof g.WebSocket||!g.WebSocket.hasOwnProperty("OPEN")?whBoard.error.push({msg:whBoard.lang.getString("notSupportWebSocket"),id:"errorWebSocket",className:"error"}):whBoard.system.webSocket=!0};whBoard.system.measureResoultion=
function(a){if("undefined"!=typeof vcan.main.offset)var b=vcan.main.offset;else b=document.getElementById("vcanvas"),b=vcan.utility.getElementOffset(b);var f=b.x;return{width:1024>a.width?1024-f:a.width-f,height:a.height-b.y}};whBoard.system.setCanvasDimension=function(){var a=whBoard.system.measureResoultion({width:g.outerWidth,height:g.innerHeight}),b=document.getElementById("vcanvas"),f=whBoard.utility.getElementRightOffSet(b);console.log("rightOffSet "+f);a.width-=f;b.style.width=a.width+"px";
"undefined"!=typeof vcan.main.canvas&&(b=vcan.main.canvas,ctx=vcan.main.canvas.getContext("2d"),b.width=a.width,b.height=a.height,a=document.getElementById("canvas"),a=vcan.utility.getElementOffset(a),vcan.main.offset.x=a.x)};whBoard.system.getResoultion=function(a){var b={};1280>a?(b.width=1024,b.height=768):1280<=a&&1366>a?(b.width=1280,b.height=1024):1366<=a&&1920>a?(b.width=1366,b.height=768):1920<=a&&(b.width=1920,b.height=1080);return b};g.addEventListener("resize",function(){g.earlierWidth!=
g.innerWidth&&whBoard.system.setCanvasDimension()});g.addEventListener("resize",function(){g.earlierWidth!=g.innerWidth&&whBoard.view.window.resize()});var a=whBoard.system.mybrowser.detection(),b=a[0],a=a[1];whBoard.system.mybrowser.name=b;whBoard.system.mybrowser.version=a;whBoard.system.isCanvasSupport(navigator,b,a);whBoard.system.isWebRtcSupport(navigator,b,a);whBoard.system.isWebSocketSupport(navigator,b,a)})(window);(function(g){var a=g.whBoard;a.createPacketContDiv=function(a,c){var d=document.createElement("div");"undefined"!=typeof a&&(d.id=a);"undefined"!=typeof c&&(d.clasName=c);return d};a.createPacketContainer=function(){var b=document.getElementById("packetContainer"),c=document.createElement("h4");c.id="dataInfoHeading";c.innerHTML=a.lang.getString("dataDetails");var d=document.getElementById("mainContainer");d.insertBefore(c,d.firstChild);c=a.createPacketContDiv("dataInformation");b.appendChild(c);
d=a.createPacketContDiv("blankDiv");d.innerHTML="&nbsp;<br/>&nbsp;";c.appendChild(d);d=a.createPacketContDiv("perSecData");d.innerHTML=a.lang.getString("perSecond");c.appendChild(d);d=a.createPacketContDiv("totalDataLabel");d.innerHTML=a.lang.getString("total");c.appendChild(d);d=a.createPacketContDiv("sendPackCont");b.appendChild(d);c=a.createPacketContDiv("sentPacketsLabel");c.innerHTML=a.lang.getString("sentPackets");d.appendChild(c);var f=a.createPacketContDiv("sendPackPsCont");d.appendChild(f);
c=a.createPacketContDiv(a.sentPackDivPS,"numbers");c.innerHTML=0;f.appendChild(c);f=a.createPacketContDiv("totSendPackCont");d.appendChild(f);c=a.createPacketContDiv(a.sentPackDiv,"numbers");c.innerHTML=0;f.appendChild(c);d=a.createPacketContDiv("receivePackCont");b.appendChild(d);b=a.createPacketContDiv("receivedPacketsLabel");b.innerHTML=a.lang.getString("receviedPackets");d.appendChild(b);b=a.createPacketContDiv("receivePackPsCont");d.appendChild(b);c=a.createPacketContDiv(a.receivedPackDivPS,
"numbers");c.innerHTML=0;b.appendChild(c);b=a.createPacketContDiv("totReceivedPackCont");d.appendChild(b);c=a.createPacketContDiv(a.receivedPackDiv,"numbers");c.innerHTML=0;b.appendChild(c)};a.createPacketInfoContainer=function(){var b=document.getElementById("informationCont");label=document.createElement("label");label.innerHTML=a.lang.getString("sentMessageInfo");var c=a.createPacketContDiv("sentMsgInfoContainer");c.appendChild(label);var d=a.createPacketContDiv("sentMsgInfo");c.appendChild(d);
b.appendChild(c);c=a.createPacketContDiv("receivedMsgInfoContainer");label=document.createElement("label");label.innerHTML=a.lang.getString("receivedMessageInfo");c.appendChild(label);d=a.createPacketContDiv("rcvdMsgInfo");c.appendChild(d);b.appendChild(c)}})(window);(function(g){var a=g.whBoard;a.draw_object=function(b,c,d){d.started=!1;var f,k,h=[];d.mousedown=function(c,f){c.detail.hasOwnProperty("cevent")&&(c.clientX=c.detail.cevent.x+a.vcan.main.offset.x,c.clientY=c.detail.cevent.y+a.vcan.main.offset.y,c.x=c.detail.cevent.x+a.vcan.main.offset.x,c.y=c.detail.cevent.x+a.vcan.main.offset.y,c.pageX=c.detail.cevent.x+a.vcan.main.offset.x,c.pageY=c.detail.cevent.y+a.vcan.main.offset.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);var k=a.vcan;lastmousemovetime=
null;d.startPosX=c.currX;d.startPosY=c.currY;if("create"==k.getStates("action")){var h=(new Date).getTime();if("text"!=b&&"t_clearall"!=a.tool.cmd){var g=k.getStates("currentTransform");if(""==g||null==g)c.detail.hasOwnProperty("cevent")||k.calculatePackets(h,"d",d.startPosX,d.startPosY),d.started=!0}else a.obj.drawTextObj.muser=!1,c.detail.hasOwnProperty("cevent")||"t_clearall"==a.tool.cmd?a.obj.drawTextObj.muser=!0:a.utility.clickOutSidebox(a.obj.drawTextObj.textWriteMode)&&k.calculatePackets(h,
"d",d.startPosX,d.startPosY),c.detail.hasOwnProperty("cevent")?c.detail.cevent.hasOwnProperty("mtext")?a.obj.drawTextObj.textUtility(d.startPosX,d.startPosY,c.detail.cevent.mtext):a.obj.drawTextObj.textUtility(d.startPosX,d.startPosY):a.obj.drawTextObj.textUtility(d.startPosX,d.startPosY)}"freeDrawing"==b&&!0==a.obj.freeDrawObj.freesvg&&a.obj.freeDrawObj.drawStart(c)};d.mousemove=function(c,g){c.detail.hasOwnProperty("cevent")&&(c.clientX=c.detail.cevent.x+a.vcan.main.offset.x,c.clientY=c.detail.cevent.y+
a.vcan.main.offset.y,c.x=c.detail.cevent.x+a.vcan.main.offset.x,c.y=c.detail.cevent.x+a.vcan.main.offset.y,c.pageX=c.detail.cevent.x+a.vcan.main.offset.x,c.pageY=c.detail.cevent.y+a.vcan.main.offset.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);if(d.started&&"t_clearall"!=a.tool.cmd)if(void 0!=a.obj.freeDrawObj&&!0==a.obj.freeDrawObj.freesvg){if(a.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&(a.obj.freeDrawObj.wb_draw(c),!c.detail.hasOwnProperty("cevent"))){"undefined"!=typeof g||"undefined"!=
typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),vcan.calculatePackets(lastmousemovetime,"m",c.currX,c.currY));var m=(new Date).getTime(),m=vcan.makeStackObj(m,"m",c.currX,c.currY);h.push(m);if("undefined"==typeof g&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-lastmousemovetime)){for(m=0;m<h.length;m++)a.uid++,h[m].uid=a.uid,vcan.main.replayObjs.push(h[m]);a.utility.beforeSend({repObj:h});a.utility.updateSentPackets(h);localStorage.repObjs=
JSON.stringify(vcan.main.replayObjs);h=[];lastmousemovetime=(new Date).getTime()}}}else{f=c.currX;k=c.currY;""!=a.prvObj&&a.canvas.removeObject(a.prvObj);var m=a.makeobj(d.startPosX,d.startPosY,f,k,b),l=a.canvas.readyObject(m);a.canvas.addObject(l);l.coreObj.usrCurrAction="create";m=(new Date).getTime();if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),c.detail.hasOwnProperty("cevent")||"text"==b||"t_clearall"==a.tool.cmd||vcan.calculatePackets(m,
"m",f,k);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&(c.detail.hasOwnProperty("cevent")||"text"==b||"t_clearall"==a.tool.cmd||vcan.calculatePackets(m,"m",f,k),lastmousemovetime=(new Date).getTime());a.prvObj=l.coreObj}else"move"==a.vcan.main.action&&(""!=vcan.main.currentTransform&&null!=vcan.main.currentTransform||"move"!=a.vcan.main.action)||a.utility.beforeSend({createArrow:!0,x:c.currX,y:c.currY})};d.mouseup=function(c,g){c.detail.hasOwnProperty("cevent")&&
(c.clientX=c.detail.cevent.x+a.vcan.main.offset.x,c.clientY=c.detail.cevent.y+a.vcan.main.offset.y,c.x=c.detail.cevent.x+a.vcan.main.offset.x,c.y=c.detail.cevent.x+a.vcan.main.offset.y,c.pageX=c.detail.cevent.x+a.vcan.main.offset.x,c.pageY=c.detail.cevent.y+a.vcan.main.offset.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);f=c.currX;k=c.currY;lastmousemovetime=null;if(d.started&&"text"!=b){d.mousemove(c,"up");if(!c.detail.hasOwnProperty("cevent")&&"freeDrawing"!=b){var m=(new Date).getTime();
vcan.calculatePackets(m,"u",f,k)}if(void 0!=a.obj.freeDrawObj&&!0==a.obj.freeDrawObj.freesvg&&(a.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&a.obj.freeDrawObj.finalizeDraw(c),!c.detail.hasOwnProperty("cevent")&&0<h.length)){m=(new Date).getTime();m=vcan.makeStackObj(m,"u",f,k);h.push(m);for(m=0;m<h.length;m++)a.uid++,h[m].uid=a.uid,vcan.main.replayObjs.push(h[m]);a.utility.beforeSend({repObj:h});localStorage.repObjs=JSON.stringify(vcan.main.replayObjs);a.utility.updateSentPackets(h);h=[]}""!=a.prvObj&&
(a.prvObj="");a.prvObj="";d.started=!1}a.vcan.wb.sentPack&&(a.vcan.wb.sentPack=!1)}}})(window);(function(g){g.whBoard.makeobj=function(a,b,c,d,f){var k={mp:{}};k.mp.x=c;k.mp.y=d;if(a>c){var h=c,g=d;c=a;d=b;a=h;b=g;k.dRoad="b2t"}else k.dRoad="t2b";k.type=f;if("rectangle"==f||"triangle"==f)k.sx=a,k.sy=b,k.ex=c,k.ey=d;if("line"==f)k.lineColor="#424240",k.lineWidth=3,k.start={x:a,y:b},k.end={x:c,y:d};else if("rectangle"==f)k.width=c-a,k.height=d-b,k.borderColor="#424240",k.lineWidth=3;else if("oval"==f)k.lineWidth=3,k.borderColor="#424240",k.width=c-a,k.height=d-b,k.x=c-k.width/2,k.y=d-k.height/
2,k.rx=k.width/2,k.ry=k.height/2;else if("triangle"==f)k.lineWidth=3,k.borderColor="#424240";else if("text"==f)return;return k}})(window);(function(g){var a=g.vcan;a.utility={canvasCalcOffset:function(b){var c=a.main;b=document.getElementById(b);b=a.utility.getElementOffset(b);return c.offset=b},getElementOffset:function(a){var c=0,d=0;do c+=a.offsetTop||0,d+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:d,y:c}},setVal:function(b,c,d){("scaleX"===c||"scaleY"===c)&&d<b.MIN_SCALE_LIMIT&&(d=b.MIN_SCALE_LIMIT);if("object"==typeof c)for(var f in c)a.utility.setVal(b,f,c[f]);else"angle"===c?a.utility.setAngle(b,d):b[c]=d;return b},getVal:function(a,
c){return a[c]},setAngle:function(a,c){a.theta=c/180*Math.PI;a.angle=c;return a},actualPointer:function(b){return{x:a.utility.pointerX(b),y:a.utility.pointerY(b)}},pointerX:function(a){var c=document.documentElement,d=document.body||{scrollLeft:0};return a.pageX||("unknown"!=typeof a.clientX?a.clientX:0)+(c.scrollLeft||d.scrollLeft)-(c.clientLeft||0)},pointerY:function(a){var c=document.documentElement,d=document.body||{scrollTop:0};return a.pageY||("unknown"!=typeof a.clientY?a.clientY:0)+(c.scrollTop||
d.scrollTop)-(c.clientTop||0)},getReltivePoint:function(b){var c=a.main.offset;b=a.utility.actualPointer(b);return{x:b.x-c.x,y:b.y-c.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(b){a.main.activeObject&&a.main.activeObject.setActive(!1);a.main.activeObject=b;b.setActive(!0);return b},updateObj:function(a){var c={};for(prop in a)"oCoords"!=prop?c[prop]=a[prop]:(c.start={},c.end={},c.start.x=a[prop].tl.x,c.start.y=a[prop].tl.y,c.end.x=a[prop].br.x,c.end.y=a[prop].br.y);
return c},setCursorFromEvent:function(a,c,d){var f=a.upperCanvasEl.style;if(d)if(c=d.findTargetCorner(c))if(c in a.cursorMap)f.cursor=a.cursorMap[c];else if("mtr"===c&&d.hasRotatingPoint)f.cursor=a.rotationCursor;else return f.cursor=this.defaulCursor,!1;else f.cursor=a.hoverCursor;else return f.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return a.main.children}}})(window);(function(g){var a=g.vcan;a.main.prototype={addObject:function(b){if("object"==typeof b.coreObj){"freehand"!=b.coreObj.type&&a.main.children.push(b.coreObj);var c=a.main.canvas.getContext("2d");a.render(c,b.coreObj)}},removeObject:function(b){a.remove(b)},bind:function(b,c){a.events().bind(a.main.canvas,b,c)},readyObject:function(b,c){b=a.extend({},b);c||void 0!=b.id||(a.main.id++,b.id=a.main.id);b.cornersize=12;b.rotatingPointOffset=40;b.selectable=!0;b.downObj=!1;b.active=!1;b.cornersize=12;b.padding=
0;b.hasControls=!0;b.cornerColor="rgba(102,153,255,0.5)";void 0==b.borderColor&&(b.borderColor="#000");b.flipX=!1;b.flipY=!1;b.draggable=!1;b.hasBorders=!0;b.hasRotatingPoint=!1;b.hideCorners=!1;b.lockRotation=!1;b.MIN_SCALE_LIMIT=.1;b.borderOpacityWhenMoving=.4;b.hasOwnProperty("theta")||(b.theta=0);b.hasOwnProperty("scaleX")||(b.scaleX=1);b.hasOwnProperty("scaleY")||(b.scaleY=1);"line"==b.type?(a.objLine=new a.line,a.objLine.init(b)):"rectangle"==b.type?(a.objRect=new a.rectangle,a.objRect.init(b)):
"oval"==b.type?(a.objOval=new a.oval,a.objOval.init(b)):"triangle"==b.type?(a.objTri=new a.triangle,a.objTri.init(b)):"text"==b.type&&(a.objTxt=new a.text,a.objTxt.init(b));b.getWidth=function(){return this.width*this.scaleX};b.getHeight=function(){return this.height*this.scaleY};b.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);this.theta=this.theta;var d=Math.cos(this.angle+this.theta)*this.hypotenuse,c=Math.sin(this.angle+this.theta)*this.hypotenuse,k=this.theta,h=Math.sin(k),k=Math.cos(k),d={x:this.x-d,y:this.y-c},c={x:d.x+this.currentWidth*k,y:d.y+this.currentWidth*h},g={x:d.x-this.currentHeight*h,y:d.y+this.currentHeight*k};this.oCoords={tl:d,tr:c,br:{x:c.x-this.currentHeight*h,y:c.y+this.currentHeight*k},bl:g,ml:{x:d.x-this.currentHeight/2*h,y:d.y+this.currentHeight/2*k},mt:{x:d.x+this.currentWidth/
2*k,y:d.y+this.currentWidth/2*h},mr:{x:c.x-this.currentHeight/2*h,y:c.y+this.currentHeight/2*k},mb:{x:g.x+this.currentWidth/2*k,y:g.y+this.currentWidth/2*h},mtr:{x:d.x+this.currentWidth/2*k,y:d.y+this.currentWidth/2*h}};this.setCornerCoords();b.findTargetCorner=function(d){var c=a.main.offset;if(!this.hasControls)return!1;var f=a.utility.actualPointer(d);d=f.x-c.x;var c=f.y-c.y,k;for(k in this.oCoords){if("mtr"===k&&!this.hasRotatingPoint)break;f=a.virtual_box.getImageLines(this.oCoords[k].corner,
k);f=a.virtual_box.findCrossPoints(d,c,f);if(1==f%2&&0!=f)return b.corner=k}return!1};return this};b.drawBorders=function(a){if(this.hasBorders){var b=this.padding,c=2*b;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var h=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),g=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(h,g);h=this.getWidth();g=this.getHeight();
a.strokeRect(~~(-(h/2)-b)+.5,~~(-(g/2)-b)+.5,~~(h+c),~~(g+c));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(b=(this.flipY?g:-g)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};b.drawCorners=function(a){if(this.hasControls){var b=this.cornersize,c=b/2,h=this.padding,g=-(this.width/2),n=-(this.height/2),m=b/this.scaleX,l=b/this.scaleY,r=(h+c)/this.scaleY,s=(h+c)/this.scaleX,
q=(h+c-b)/this.scaleX,c=(h+c-b)/this.scaleY,h=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(g-s,n-r,m,l);b=g+this.width-s;a.fillRect(b,n-r,m,l);a.fillRect(g-s,n+h+c,m,l);b=g+this.width+q;a.fillRect(b,n+h+c,m,l);b=g+this.width/2-s;a.fillRect(b,n-r,m,l);b=g+this.width/2-s;a.fillRect(b,n+h+c,m,l);b=g+this.width+q;a.fillRect(b,n+h/2-r,m,l);a.fillRect(g-s,n+h/2-r,m,l);this.hasRotatingPoint&&(b=g+this.width/2-s,g=this.flipY?n+h+this.rotatingPointOffset/this.scaleY-l/2:n-this.rotatingPointOffset/
this.scaleY-l/2,a.fillRect(b,g,m,l));a.restore();return this}};b.setActive=function(a){this.active=!!a;return this};b.dragDrop=function(a){this.draggable=void 0!=a?a:!1};b.setCornerCoords=function(){var b=this.oCoords,c=a.utility.degreesToRadians(45-this.getAngle()),k=Math.sqrt(2*Math.pow(this.cornersize,2))/2,h=k*Math.cos(c),c=k*Math.sin(c),k=Math.sin(this.theta),g=Math.cos(this.theta);b.tl.corner={tl:{x:b.tl.x-c,y:b.tl.y-h},tr:{x:b.tl.x+h,y:b.tl.y-c},bl:{x:b.tl.x-h,y:b.tl.y+c},br:{x:b.tl.x+c,y:b.tl.y+
h}};b.tr.corner={tl:{x:b.tr.x-c,y:b.tr.y-h},tr:{x:b.tr.x+h,y:b.tr.y-c},br:{x:b.tr.x+c,y:b.tr.y+h},bl:{x:b.tr.x-h,y:b.tr.y+c}};b.bl.corner={tl:{x:b.bl.x-c,y:b.bl.y-h},bl:{x:b.bl.x-h,y:b.bl.y+c},br:{x:b.bl.x+c,y:b.bl.y+h},tr:{x:b.bl.x+h,y:b.bl.y-c}};b.br.corner={tr:{x:b.br.x+h,y:b.br.y-c},bl:{x:b.br.x-h,y:b.br.y+c},br:{x:b.br.x+c,y:b.br.y+h},tl:{x:b.br.x-c,y:b.br.y-h}};b.ml.corner={tl:{x:b.ml.x-c,y:b.ml.y-h},tr:{x:b.ml.x+h,y:b.ml.y-c},bl:{x:b.ml.x-h,y:b.ml.y+c},br:{x:b.ml.x+c,y:b.ml.y+h}};b.mt.corner=
{tl:{x:b.mt.x-c,y:b.mt.y-h},tr:{x:b.mt.x+h,y:b.mt.y-c},bl:{x:b.mt.x-h,y:b.mt.y+c},br:{x:b.mt.x+c,y:b.mt.y+h}};b.mr.corner={tl:{x:b.mr.x-c,y:b.mr.y-h},tr:{x:b.mr.x+h,y:b.mr.y-c},bl:{x:b.mr.x-h,y:b.mr.y+c},br:{x:b.mr.x+c,y:b.mr.y+h}};b.mb.corner={tl:{x:b.mb.x-c,y:b.mb.y-h},tr:{x:b.mb.x+h,y:b.mb.y-c},bl:{x:b.mb.x-h,y:b.mb.y+c},br:{x:b.mb.x+c,y:b.mb.y+h}};b.mtr.corner={tl:{x:b.mtr.x-c+k*this.rotatingPointOffset,y:b.mtr.y-h-g*this.rotatingPointOffset},tr:{x:b.mtr.x+h+k*this.rotatingPointOffset,y:b.mtr.y-
c-g*this.rotatingPointOffset},bl:{x:b.mtr.x-h+k*this.rotatingPointOffset,y:b.mtr.y+c-g*this.rotatingPointOffset},br:{x:b.mtr.x+c+k*this.rotatingPointOffset,y:b.mtr.y+h-g*this.rotatingPointOffset}}};b.getAngle=function(){return 180*this.theta/Math.PI};b.setZindex=function(){for(var b=0;b<a.main.children.length;b++)if(this.id==a.main.children[b].id){var c=a.main.children[b];a.main.children.splice(b,1);break}return" "!=c?(a.main.children.push(c),!0):!1};b.setupCurrentTransform=function(b){var c=a.main,
k="drag",h=a.utility.actualPointer(b);if(b=this.findTargetCorner(b))k="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":this.hasRotatingPoint?"scale":"rotate";c.currentTransform={target:this,action:k,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:h.x-this.x,offsetY:h.y-this.y,ex:h.x,ey:h.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};c.currentTransform.original={x:this.x,y:this.y}};"text"!=b.type&&b.setCoords();return a.makeDispObject(b)}}})(window);(function(g){var a=g.vcan;a.events=function(){return{bind:function(a,c,d){a["on"+c]=d},findTarget:function(b){for(var c,d=a.main.children,f=d.length;f--;)if(d[f]&&a.virtual_box.containsPoint(b,d[f])){c=d[f];break}if(c&&c.selectable)return c}}}})(window);(function(g){var a=g.vcan;a.virtual_box={findCrossPoints:function(a,c,d){var f,k,h,g=0,n;for(n in d)if(h=d[n],!(h.o.y<c&&h.d.y<c||h.o.y>=c&&h.d.y>=c)&&(h.o.x==h.d.x&&h.o.x>=a?f=h.o.x:(f=(h.d.y-h.o.y)/(h.d.x-h.o.x),k=c-0*a,h=h.o.y-f*h.o.x,f=-(k-h)/(0-f)),f>=a&&(g+=1),2==g))break;return g},getImageLines:function(a,c){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(b,c){var d=a.utility.getReltivePoint(b),f=d.x,d=d.y,
k=a.virtual_box.getImageLines(c.oCoords);return(f=a.virtual_box.findCrossPoints(f,d,k))&&1===f%2||c.findTargetCorner(b)?!0:!1}}})(window);(function(g){var a=g.vcan;a.interact={rotateObject:function(b,c){var d=a.main.currentTransform,f=a.main.offset;if(!d.target.lockRotation){var k=Math.atan2(d.ey-d.y-f.y,d.ex-d.x-f.x),f=Math.atan2(c-d.y-f.y,b-d.x-f.x);a.utility.setVal(d.target,"theta",f-k+d.theta)}},scaleObject:function(b,c,d){var f=a.main.currentTransform,k=a.main.offset;target=f.target;if(!target.lockScalingX||!target.lockScalingY){var h=Math.sqrt(Math.pow(f.ey-f.y-k.y,2)+Math.pow(f.ex-f.x-k.x,2));b=Math.sqrt(Math.pow(c-f.y-k.y,2)+
Math.pow(b-f.x-k.x,2));target.scaling=!0;d?"x"!==d||target.lockUniScaling?"y"!==d||target.lockUniScaling||target.lockScalingY||a.utility.setVal(target,"scaleY",f.scaleY*b/h):target.lockScalingX||a.utility.setVal(target,"scaleX",f.scaleX*b/h):(target.lockScalingX||a.utility.setVal(target,"scaleX",f.scaleX*b/h),target.lockScalingY||a.utility.setVal(target,"scaleY",f.scaleY*b/h))}},translateObject:function(b,c){var d=a.main.currentTransform.target;d.lockMovementX||a.utility.setVal(d,"x",b-a.main.currentTransform.offsetX);
d.lockMovementY||a.utility.setVal(d,"y",c-a.main.currentTransform.offsetY);return d}}})(window);(function(g){g.vcan.rectangle=function(){return{type:"rectangle",init:function(a){void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,c){c=-b.width/2;var d=-b.height/2,f=b.width,k=b.height;a.beginPath();a.strokeStyle=void 0!=b.borderColor?'"'+b.strokeColor+'"':"#000";a.moveTo(c,d);a.stroke();a.lineTo(c+f,d);a.stroke();a.lineTo(c+f,d+k);a.stroke();a.lineTo(c,d+k);a.stroke();a.lineTo(c,d);a.fillStyle=void 0!=b.fillColor?b.fillColor:" ";a.closePath();a.stroke();
void 0!=b.fillColor&&(a.fillStyle=b.fillColor,a.fill())}}}})(window);(function(g){g.vcan.oval=function(){return{type:"oval",init:function(a){void 0==a.width&&(a.width=2*a.rx);void 0==a.height&&(a.height=2*a.ry);void 0==a.borderColor&&(a.borderColor="#000000");void 0!=a.fillColor&&(a.fillStyle=a.fillColor);return a},draw:function(a,b,c){a.beginPath();a.save();var d=2*Math.PI;a.lineWidth=b.lineWidth;var f=b.ry/b.rx,f=f.toFixed(3);0==f&&(f=.01);a.transform(1,0,0,f,0,0);a.arc(c?b.x:0,c?b.y:0,b.rx,0,d,!1);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());
void 0!=b.borderColor&&(a.fillStyle=b.borderColor,a.stroke());a.restore()}}}})(window);(function(g){g.vcan.triangle=function(){return{type:"triangle",init:function(a){a.fillStyle=a.fillColor;void 0==a.dRoad&&(a.dRoad="ltr");void 0==a.width&&(a.width=a.ex-a.sx);void 0==a.height&&(a.height=a.ey-a.sy);void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,c){a.beginPath();if("t2b"==b.dRoad){c=b.width/2;var d=b.height/2}else c=-b.width/2,d=-b.height/2;a.lineWidth=b.lineWidth;void 0!=b.borderColor&&(a.strokeStyle=b.borderColor);a.moveTo(-c,d);a.lineTo(0,
-d);a.lineTo(c,d);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());a.stroke()}}}})(window);(function(g){g.vcan.line=function(){return{type:"line",init:function(a){var b=a.start.x,c=a.start.y,d=a.end.x,f=a.end.y;void 0==a.width&&(a.width=d-b,a.height=f-c);a.x=b+(d-b)/2;a.y=c+(f-c)/2;return a},draw:function(a,b,c){a.beginPath();c=1===b.width?0:b.width/2;var d=1===b.height?0:b.height/2;a.moveTo(1===b.width?0:-b.width/2,1===b.height?0:-b.height/2);a.lineTo(c,d);a.lineWidth=b.lineWidth;void 0!=b.lineColor&&(a.strokeStyle=b.lineColor);a.closePath();a.stroke()}}}})(window);(function(g){g.vcan.text=function(){return{type:"text",init:function(a){a.lineHeight=1.3;void 0==a.fontSize&&(a.fontSize=30);a.font=a.fontSize+"px Times New Roman";return a},draw:function(a,b,c){a.font=b.font;c=b.text.split(/\r?\n/);b.height=this.getTextHeight(a,c,b);b.width=this.getTextWidth(a,c);a.beginPath();for(var d=0,f=c.length;d<f;d++)a.fillText(c[d],-b.width/2,-b.height/2+d*b.fontSize*b.lineHeight+b.fontSize);a.closePath();b.setCoords()},getTextWidth:function(a,b){for(var c=a.measureText(b[0]).width,
d=1,f=b.length;d<f;d++){var k=a.measureText(b[d]).width;k>c&&(c=k)}return c},getTextHeight:function(a,b,c){return c.fontSize*b.length*c.lineHeight},removeTextNode:function(){for(var a=document.getElementsByClassName("textBoxContainer"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])}}}})(window);(function(g){var a=g.vcan;a.main.freeHandDrawing=function(b){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==b.borderColor?"#000000":b.borderColor;this.freeDrawingLineWidth=void 0!=b.lineWidth?b.lineWidth:"3";return this},fhdStart:function(a,b,f){f=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);
this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(f);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){var f=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(f)},finalizeDrawingPath:function(c,d,f){(new Date).getTime();
this.contextTop.closePath();this.isCurrentlyDrawing=!1;var k=this.utility.min(this.freeDrawingXPoints);d=this.utility.min(this.freeDrawingYPoints);var h=this.utility.max(this.freeDrawingXPoints);f=this.utility.max(this.freeDrawingYPoints);var g=[],n,m,l,r=this.freeDrawingXPoints,s=this.freeDrawingYPoints,q=this.mdTime;g.push("M ",r[0]-k," ",s[0]-d," ",q[0]," ");for(var t=1;n=r[t],m=s[t],l=q[t];t++)g.push("L ",n-k," ",m-d," ",l," ");g=g.join("");if("M 0 0 L 0 0 "!==g)return n=this.freeDrawingXPoints[this.freeDrawingXPoints.length-
1],m=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],l=new a.Path(g,this),l.mp={},l.mp.x=n,l.mp.y=m,l.init(g),l=c.readyObject(l),l.coreObj.type="freeDrawing",l=l.coreObj,l.fill=null,l.stroke=this.freeDrawingColor,l.strokeWidth=this.freeDrawingLineWidth,l.minX=k,l.minY=d,this.utility.objAdd(l),c=a.utility.setVal(l,"x",k+(h-k)/2),c=a.utility.setVal(c,"y",d+(f-d)/2),c.setCoords(),"object"==typeof b&&this.contextTop.restore(),a.renderAll(this.contextTop),c},utility:{max:function(a,b){if(a&&
0!==a.length){var f=a.length-1,k=b?a[f][b]:a[f];if(b)for(;f--;)a[f][b]>=k&&(k=a[f][b]);else for(;f--;)a[f]>=k&&(k=a[f]);return k}},min:function(a,b){if(a&&0!==a.length){var f=a.length-1,k=b?a[f][b]:a[f];if(b)for(;f--;)a[f][b]<k&&(k=a[f][b]);else for(;f--;)a[f]<k&&(k=a[f]);return k}},objAdd:function(b){a.main.children.push(b);return this}}}}})(window);(function(g){var a=g.vcan;a.Path=function(b,c){return{objectType:"path",init:function(a,b){b=b||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(b),this},initializeFromArray:function(a){var b="width"in a,c="height"in a;this.path=this._parsePath();b&&c||(this.utility.extend(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height))},
_render:function(a){var b,c=0;b=0;for(var h=-(this.width/2),g=-(this.height/2),n=0,m=this.path.length;n<m;++n)switch(b=this.path[n],b[0]){case "L":c=b[1];b=b[2];a.lineTo(c+h,b+g);break;case "M":c=b[1],b=b[2],a.moveTo(c+h,b+g)}},replay_render:function(a,b,c,h){var g=y=0;switch(b[0]){case "L":g+=b[1];y+=b[2];a.lineTo(g+c,y+h);a.stroke();break;case "M":g+=b[1],y+=b[2],a.moveTo(g+c,y+h)}},render:function(b,c){b.save();var k=this.transformMatrix;k&&b.transform(k[0],k[1],k[2],k[3],k[4],k[5]);c||a.transform(b,
this);this.overlayFill?b.fillStyle=this.overlayFill:this.fill&&(b.fillStyle=this.fill);this.stroke&&(b.strokeStyle=this.stroke);b.beginPath();this._render(b);this.fill&&b.fill();this.stroke&&(b.strokeStyle=this.stroke,b.lineWidth=this.strokeWidth,b.lineCap=b.lineJoin="round",b.stroke());!c&&this.active&&(this.drawBorders(b),this.hideCorners||this.drawCorners(b));b.restore()},_parsePath:function(){for(var a=[],b,c,h,g=0,n,m=this.path.length;g<m;g++){var l=/\d+\s$/.exec(this.path[g]);null!=l&&(b=this.path[g].indexOf(l),
this.path[g]=this.path[g].substring(0,b));b=this.path[g];c=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);b=[b.charAt(0)];n=0;for(var r=c.length;n<r;n++)h=parseFloat(c[n]),isNaN(h)||b.push(h);c=b[0].toLowerCase();c=this.commandLengths[c];if(b.length-1>c)for(h=1,n=b.length;h<n;h+=c)null==l?a.push([b[0]].concat(b.slice(h,h+c))):(a.push([b[0]].concat(b.slice(h,h+c))),b.push(l),a.push(b));else null!=l&&b.push(l[0]),a.push(b)}return a},_parseDimensions:function(){var a=[],b=[],k,h,g=!1,
n,m;this.path.forEach(function(c,l){if(" "!=c[3])var q=c.splice(3);"H"!==c[0]&&(k=0===l?this.utility.getX(c):this.utility.getX(this.path[l-1]));"V"!==c[0]&&(h=0===l?this.utility.getY(c):this.utility.getY(this.path[l-1]));c[0]===c[0].toLowerCase()&&(g=!0);n=g?k+this.utility.getX(c):"V"===c[0]?k:this.utility.getX(c);m=g?h+this.utility.getY(c):"H"===c[0]?h:this.utility.getY(c);var t=parseInt(n,10);isNaN(t)||a.push(t);t=parseInt(m,10);isNaN(t)||b.push(t);void 0!=q&&1<=q.length&&c.push(q[0])},this);var l=
c.utility.min(a),l={y:c.utility.min(b)-0,x:l-0,bottom:c.utility.max(b)-0,right:c.utility.max(a)-0};l.width=l.right-l.x;l.height=l.bottom-l.y;return l},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,b){for(var c in b)a[c]=b[c];return a}}}}})(window);(function(g){var a=g.vcan;a.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=a.main.canvas;var b={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};for(type in b)"mousedown"==type?canvasElement.addEventListener(type,this.mousedown,!1):"mousemove"==type?canvasElement.addEventListener(type,this.mousemove,!1):"mouseup"==type&&canvasElement.addEventListener(type,this.mouseup,!1)},mousedown:function(b,c){b.detail.hasOwnProperty("cevent")&&
"create"!=a.main.action&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];if("move"==a.main.action){if(!a.main.currentTransform){var d=a.events().findTarget(b);a.utility.getReltivePoint(b);d?(0<a.main.children.length&&
d.setZindex(),d.downObj=!0,d.setupCurrentTransform(b),a.utility.setActiveObject(d),a.main.currObj=d):a.deactivateAll();void 0!=d&&a.renderAll();b.detail.hasOwnProperty("cevent")||(d=(new Date).getTime(),d=a.makeStackObj(d,"d",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y),whBoard.uid++,console.log("uid "+whBoard.uid),d.uid=whBoard.uid,a.main.replayObjs.push(d),whBoard.utility.beforeSend({repObj:[d]}),whBoard.utility.updateSentPackets(d))}}else"create"==a.main.action&&(b.detail.hasOwnProperty("cevent")&&
(b.clientX=b.detail.cevent.x+whBoard.vcan.main.offset.x,b.clientY=b.detail.cevent.y+whBoard.vcan.main.offset.y,b.x=b.detail.cevent.x+whBoard.vcan.main.offset.x,b.y=b.detail.cevent.x+whBoard.vcan.main.offset.y,b.pageX=b.detail.cevent.x+whBoard.vcan.main.offset.x,b.pageY=b.detail.cevent.y+whBoard.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y),d=a.events().findTarget(b),a.utility.getReltivePoint(b),d&&"text"==d.type&&"t_text"==whBoard.tool.cmd&&d.setupCurrentTransform(b))},mousemove:function(b){b.detail.hasOwnProperty("cevent")&&
(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if("move"==a.main.action){var c=a.main;if(c.currentTransform){var d=a.utility.actualPointer(b),f=d.x,d=d.y;c.currentTransform.target.isMoving=!0;if("rotate"===c.currentTransform.action)a.interact.rotateObject(f,
d),c.currentTransform.target.hasRotatingPoint||a.interact.scaleObject(f,d),b.detail.hasOwnProperty("cevent")||a.doOptiMize(b);else if("scale"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.doOptiMize(b),a.interact.scaleObject(f,d);else if("scaleX"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.doOptiMize(b),a.interact.scaleObject(f,d,"x");else if("scaleY"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.doOptiMize(b),a.interact.scaleObject(f,d,"y");
else if(c.currentTransform.target.draggable){var k=a.extend({},a.main.currentTransform.target);(new Date).getTime();!0==c.currentTransform.target.downObj&&(a.main.dragMode=!0,c.currentTransform.target.downObj=!1);k=a.interact.translateObject(f,d);b.detail.hasOwnProperty("cevent")||a.doOptiMize(b);k.setActive(!0);k.setCoords()}if("scaleX"===c.currentTransform.action||"scaleY"===c.currentTransform.action||"rotate"===c.currentTransform.action&&!c.currentTransform.target.hasRotatingPoint)a.main.scaleMode=
!0,(new Date).getTime(),c.currentTransform.target.downObj&&(c.currentTransform.target.downObj=!1),k=a.extend({},a.main.currentTransform.target),k.setCoords();a.renderAll()}else a.events().findTarget(b)}},mouseup:function(b){b.detail.hasOwnProperty("cevent")&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,
b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;if("move"==a.main.action){a.activMouse.mousemove(b);var c=a.main;if(c.currentTransform){var d=c.currentTransform.target;d.scaling&&(d.scaling=!1);for(d=c.children.length;d--;)c.children[d].setCoords()}c.currentTransform=null;a.renderAll();if(!0==a.main.dragMode||!0==a.main.scaleMode){a.utility.actualPointer(b);var f=(new Date).getTime();b.detail.hasOwnProperty("cevent")||a.calculatePackets(f,"u",b.clientX-a.main.offset.x,
b.clientY-a.main.offset.y);a.main.dragMode&&(a.main.dragMode=!1);a.main.scaleMode&&(a.main.scaleMode=!1)}else b.detail.hasOwnProperty("cevent")||a.calculatePackets(f,"u",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y);a.wb.sentPack=!0}}}}})(window);(function(g){var a=g.whBoard;a.readyFreeHandObj=function(b,c){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=b;this.freeDrawingLineWidth=c},drawStart:function(b){var c=a.vcan;if(!0==a.obj.freeDrawObj.freesvg){var k=c.main.canvas.getContext("2d");this.fdObj=c.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=c.utility.getReltivePoint(b);this.fdObj.fhdStart(k,pointer)}},wb_draw:function(a){a=vcan.utility.getReltivePoint(a);
this.fdObj.fhRendering(a)},finalizeDraw:function(b){b=a.vcan;a.prvObj=this.fdObj.finalizeDrawingPath(a.canvas);b.main.children[b.main.children.length-1].mt=a.utility.stringToNumber(a.prvObj.path[a.prvObj.path.length-1][3])}}}})(window);(function(g){var a=g.whBoard;a._replay=function(){return{init:function(b){this.objs=a.vcan.getStates("replayObjs");this.objNo=0;this.repMode=b;this.callBkfunc=""},renderObj:function(b){a.drawMode=!0;wbRep=a.replay;if("undefined"==typeof wbRep.objs[wbRep.objNo])console.log("is this happend");else{"undefined"!=typeof b&&(wbRep.callBkfunc=b);if(wbRep.objs[wbRep.objNo].hasOwnProperty("cmd"))a.gObj.displayedObjId=wbRep.objs[wbRep.objNo].uid,a.toolInit(wbRep.objs[wbRep.objNo].cmd,"fromFile",!0);else{b=
"";"d"==wbRep.objs[wbRep.objNo].ac?b="mousedown":"m"==wbRep.objs[wbRep.objNo].ac?b="mousemove":"u"==wbRep.objs[wbRep.objNo].ac&&(b="mouseup");var c=wbRep.objs[wbRep.objNo],c=c.hasOwnProperty("mtext")?{detail:{cevent:{x:c.x,y:c.y,mtext:c.mtext}}}:{detail:{cevent:{x:c.x,y:c.y}}};a.gObj.displayedObjId=wbRep.objs[wbRep.objNo].uid;b=new CustomEvent(b,c);vcan.main.canvas.dispatchEvent(b)}"function"==typeof wbRep.callBkfunc&&wbRep.objs[wbRep.objs.length-1].uid==a.gObj.displayedObjId&&wbRep.callBkfunc("callBkfunc");
"object"==typeof wbRep.objs[wbRep.objNo+1]&&(a.replayTime=wbRep.objs[wbRep.objNo+1].mt-wbRep.objs[wbRep.objNo].mt,wbRep.objNo++,"undefined"!=typeof wbRep.repMode&&"fromBrowser"==wbRep.repMode&&(a.replayTime=0),setTimeout(wbRep.renderObj,a.replayTime))}}}}})(window);(function(g){var a=g.whBoard;a.readyTextObj=function(){return{init:function(a){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=a;this.muser=!1},textUtility:function(b,c,d){this.startPosX=b;this.startPosY=c;var f=a.vcan,k=f.main.canvas.getContext("2d"),h={};this.textWriteMode++;this.wmode=!0;void 0!=f.main.currentTransform&&""!=f.main.currentTransform?(this.currObject=f.main.currentTransform.target,
void 0!=this.currObject&&"text"==this.currObject.type&&(h={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},a.utility.clickOutSidebox(this.textWriteMode)||a.obj.drawTextObj.drawTextBoxWrapper(h,this.currObject.id),f.main.currentTransform=""),a.utility.clickOutSidebox(this.textWriteMode)&&a.obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,k),void 0!=this.currObject&&"text"==this.currObject.type&&(this.prvModTextObj={prvObjId:this.currObject.id,
prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):a.utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof d?a.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,k,d):a.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,k):(this.totalBox++,h={x:b,y:c,width:300,height:100},"undefined"==typeof d?a.obj.drawTextObj.drawTextBoxWrapper(h,this.totalBox):a.obj.drawTextObj.drawTextBoxWrapper(h,
this.totalBox,d))},drawTextBoxWrapper:function(b,c,d){var f=a.vcan;d=document.createElement("div");d.id="box"+c;d.className="textBoxContainer";d.style.position="absolute";d.style.left=f.main.offset.x+b.x+"px";d.style.top=b.y+"px";c=document.createElement("textarea");c.id=d.id+"textarea";c.rows=8;c.cols=41;void 0!=b.text&&""!=b.text&&(c.value=b.text);d.appendChild(c);document.getElementById(this.boxContainer).appendChild(d);this.prevTextObj=d;this.currTextObjWrapper=b;this.prevTextObj.measure=b},renderText:function(b,
c,d,f){var k=a.vcan;if(""!=this.prevTextObj){if(!a.utility.IsObjEmpty(b))for(var h=0;h<k.main.children.length;h++)if(b.id==k.main.children[h].id){k.main.children.splice(h,1);this.currObject="";break}a.utility.IsObjEmpty(b)?"undefined"!=typeof f?this.finalizeText(d,this.prevTextObj,void 0,f):this.finalizeText(d,this.prevTextObj):"undefined"!=typeof f?this.finalizeText(d,this.prevTextObj,c,f):this.finalizeText(d,this.prevTextObj,c);a.obj.drawTextObj.wmode=!1}},finalizeText:function(b,c,d,f){d=a.vcan;
var k=document.getElementById(c.id),h="";if("undefined"==typeof f){f=k.getElementsByTagName("textarea");for(var g=0;g<f.length;g++)if(f[g].id==k.id+"textarea"){h=f[g].value;break}}else h=f;b.font="20px Times New Roman";var n=0,m=h.split(/\r?\n/),n=b.measureText(m[0]).width;f=15;for(g=1;g<m.length;g++){f+=15;var l=b.measureText(m[g]).width;l>n&&(n=l)}n/=2;g=(new Date).getTime();b={type:"text",text:h,x:c.measure.x+n,y:c.measure.y+f,fontSize:20,fontWidth:b.measureText(h).width,mp:{x:c.measure.x,y:c.measure.y}};
!1==a.obj.drawTextObj.muser&&(h={mt:g,ac:"d",x:this.startPosX,y:this.startPosY,mtext:b.text},a.uid++,h.uid=a.uid,d.main.replayObjs.push(h),localStorage.repObjs=JSON.stringify(d.main.replayObjs),a.utility.beforeSend({repObj:[h]}),a.utility.updateSentPackets(h));b=a.canvas.readyObject(b);a.canvas.addObject(b);d.main.children[d.main.children.length-1].mt=g;k.parentNode.removeChild(c);d.renderAll();0<a.sentPackets&&null!=document.getElementById(a.sentPackDiv)&&(document.getElementById(a.sentPackDiv).innerHTML=
a.sentPackets)}}}})(window);(function(g){g.onload=function(){var a=g.whBoard;a.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(b){b.shiftKey&&(console.log("what happend mere bhai"),a.keyBoard.skey=!0,a.keyBoard.prvTool=a.tool.cmd,a.toolInit("t_activeall"),b={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(b),a.utility.beforeSend({repObj:[b]}),a.vcan.main.action="move")},triggerdeActiveAll:function(b){a.keyBoard.skey&&(console.log("what happend mere bhai ddd"),b=(new Date).getTime(),a.utility.deActiveFrmDragDrop(),
a.toolInit(a.keyBoard.prvTool),b={cmd:a.keyBoard.prvTool,mt:b},vcan.main.replayObjs.push(b),a.utility.beforeSend({repObj:[b]}))}}}})(window);(function(g){var a=g.whBoard;a.RTCPeerConnection=null;g.webrtcDetectedBrowser=null;!0==a.system.wbRtc.peerCon&&!0==a.system.wbRtc.userMedia&&(navigator.mozGetUserMedia?(console.log("This appears to be Firefox"),g.webrtcDetectedBrowser="firefox",a.RTCPeerConnection=mozRTCPeerConnection,a.RTCSessionDescription=mozRTCSessionDescription,a.RTCIceCandidate=mozRTCIceCandidate,navigator.getUserMedia=navigator.mozGetUserMedia,a.attachMediaStream=function(b,c){a.videoAdd=!0;console.log("Attaching media stream");
b.mozSrcObject=c;b.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):navigator.webkitGetUserMedia?(console.log("This appears to be Chrome"),g.webrtcDetectedBrowser="chrome",a.RTCPeerConnection=webkitRTCPeerConnection,a.RTCSessionDescription=RTCSessionDescription,a.RTCIceCandidate=RTCIceCandidate,navigator.getUserMedia=navigator.webkitGetUserMedia,a.attachMediaStream=function(b,c){b.src=g.URL.createObjectURL(c);a.videoAdd=!0},
webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable"))})(window);(function(g){sumanbog=0;var a=g.io,b=g.vcan,c=g.whBoard,d=function(){console.log("this error is come when the create and answer is occurring")};b.videoChat=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",localStream:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",init:function(a){cthis=this;b.oneExecuted=!0;cthis.createMiniMizeButton();b.videoChat.localVideo=document.querySelector("#localVideo");
b.videoChat.remoteVideo=document.querySelector("#remoteVideo");b.videoChat.remoteVideo2=document.querySelector("#remoteVideo2");this.pc_config="firefox"===g.webrtcDetectedBrowser?{iceServers:[{url:"stun:23.21.150.121"}]}:{iceServers:[{url:"stun:stun.l.google.com:19302"}]};this.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]};this.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};this.constraints={video:!0,audio:!0,cthis:this};navigator.getUserMedia(this.constraints,
this.handleUserMedia,this.handleUserMediaError);c.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(c.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0);console.log("Getting user media with constraints",this.constraints)},sendMessage:function(a){1<arguments.length?c.utility.beforeSend({video:a},arguments[1]):c.utility.beforeSend({video:a})},handleUserMedia:function(a){c.view.disappearBox("WebRtc");cthis.localStream=a;c.attachMediaStream(b.videoChat.localVideo,a);1==c.clientLen&&
cthis.sendMessage("got user media");2<=c.clientLen&&c.utility.beforeSend({vidInit:!0})},handleUserMediaError:function(a){c.view.disappearBox("WebRtc");console.log("navigator.getUserMedia error: ",a)},maybeStart:function(a){if(a!=wbUser.id&&!cthis.isStarted&&cthis.localStream&&cthis.isChannelReady||a==wbUser.id&&!cthis.isStarted&&cthis.localStream&&cthis.isChannelReady||"undefined"!=typeof cthis.byCommand||c.joinUserId==wbUser.id&&!cthis.isStarted&&cthis.localStream&&cthis.isChannelReady&&!cthis.isInitiator)0<
cthis.pc.length&&cthis.cn++,cthis.createPeerConnection(),cthis.pc[cthis.cn].addStream(cthis.localStream),cthis.isStarted=!0,cthis.isInitiator&&cthis.doCall()},createPeerConnection:function(){try{var a=new c.RTCPeerConnection(this.pc_config,this.pc_constraints);cthis.pc.push(a);cthis.pc[cthis.cn].onicecandidate=cthis.handleIceCandidate;cthis.pc[cthis.cn].onclosedconnection=function(){};console.log("Created RTCPeerConnnection with:\n  config: '"+JSON.stringify(this.pc_config)+"';\n  constraints: '"+
JSON.stringify(this.pc_constraints)+"'.")}catch(b){console.log("Failed to create PeerConnection, exception: "+b.message);return}cthis.pc[cthis.cn].onaddstream=cthis.handleRemoteStreamAdded;cthis.pc[cthis.cn].onremovestream=cthis.handleRemoteStreamRemoved},handleIceCandidate:function(a){console.log("handleIceCandidate event: ",a);a.candidate?cthis.sendMessage({type:"candidate",label:a.candidate.sdpMLineIndex,id:a.candidate.sdpMid,candidate:a.candidate.candidate}):console.log("End of candidates.")},
handleRemoteStreamAdded:function(a){console.log("Remote stream added.");0==cthis.cn?(c.attachMediaStream(b.videoChat.remoteVideo,a.stream),cthis.remoteStream=a.stream):1<cthis.pc.length&&(c.attachMediaStream(b.videoChat.remoteVideo2,a.stream),cthis.remoteStream=a.stream)},doCall:function(){var a={optional:[],mandatory:{MozDontOfferDataChannel:!0}};if("chrome"===g.webrtcDetectedBrowser)for(var b in a.mandatory)-1!==b.indexOf("Moz")&&delete a.mandatory[b];a=this.mergeConstraints(a,this.sdpConstraints);
console.log("Sending offer to peer, with constraints: \n  '"+JSON.stringify(a)+"'.");crtOffer=!0;cthis.pc[cthis.cn].createOffer(this.setLocalAndSendMessage,d,a)},doAnswer:function(){console.log("Sending answer to peer.");crtAns=!0;cthis.pc[cthis.cn].createAnswer(this.setLocalAndSendMessage,d,this.sdpConstraints)},mergeConstraints:function(a,b){for(var c in b.mandatory)a.mandatory[c]=b.mandatory[c];a.optional.concat(b.optional);return a},setLocalAndSendMessage:function(a){a.sdp=cthis.preferOpus(a.sdp);
cthis.pc[cthis.cn].setLocalDescription(a);cthis.sendMessage(a)},handleRemoteStreamRemoved:function(a){console.log("Remote stream removed. Event: ",a)},hangup:function(){cthis.stop();cthis.sendMessage("bye")},handleRemoteHangup:function(){console.log("Session terminated.");cthis.transitionToWaiting();cthis.isInitiator=!0;cthis.isStarted=!1;cthis.stop();cthis.pc.splice(0,1)},transitionToWaiting:function(){b.videoChat.remoteVideo.src=""},stop:function(){this.isStarted=!1;this.pc[cthis.cn].close();this.pc[cthis.cn]=
null;this.pc.splice(0,1)},preferOpus:function(a){for(var b=a.split("\r\n"),c,d=0;d<b.length;d++)if(-1!==b[d].search("m=audio")){c=d;break}if(null===c)return a;for(d=0;d<b.length;d++)if(-1!==b[d].search("opus/48000")){(a=cthis.extractSdp(b[d],/:(\d+) opus\/48000/i))&&(b[c]=cthis.setDefaultCodec(b[c],a));break}b=this.removeCN(b,c);return a=b.join("\r\n")},extractSdp:function(a,b){var c=a.match(b);return c&&2===c.length?c[1]:null},setDefaultCodec:function(a,b){for(var c=a.split(" "),d=[],g=0,m=0;m<c.length;m++)3===
g&&(d[g++]=b),c[m]!==b&&(d[g++]=c[m]);return d.join(" ")},removeCN:function(a,b){for(var c=a[b].split(" "),d=a.length-1;0<=d;d--){var g=cthis.extractSdp(a[d],/a=rtpmap:(\d+) CN\/\d+/i);g&&(g=c.indexOf(g),-1!==g&&c.splice(g,1),a.splice(d,1))}a[b]=c.join(" ");return a},videoOnMsg:function(a,b){a.hasOwnProperty("isChannelReady")&&(cthis.isChannelReady=!0);console.log("Received message:",a);if("got user media"===a)cthis.maybeStart(b);else if("offer"===a.type)cthis.isInitiator||cthis.isStarted||cthis.maybeStart(b),
cthis.pc[cthis.cn].setRemoteDescription(new c.RTCSessionDescription(a)),cthis.doAnswer();else if("answer"===a.type&&cthis.isStarted)cthis.pc[cthis.cn].setRemoteDescription(new c.RTCSessionDescription(a));else if("candidate"===a.type&&cthis.isStarted){var d=new c.RTCIceCandidate({sdpMLineIndex:a.label,candidate:a.candidate});cthis.pc[cthis.cn].addIceCandidate(d)}else"bye"===a&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},miniMizeVideo:function(){document.getElementById(cthis.videoControlId).style.display=
"none";cthis.removeButton(cthis.minButtonId);cthis.createMaxMizeButton()},maxMizeVideo:function(a){cthis.createMiniMizeButton();document.getElementById(cthis.videoControlId).style.display="block";cthis.removeButton(cthis.maxButtonId)},removeButton:function(a){a=document.getElementById(a);a.parentNode.removeChild(a)},createMiniMizeButton:function(){cthis.minButtonId="videoMinMize";var a=document.createElement("div");a.id=cthis.minButtonId;a.innerHTML='<a href="#" title="" data-title="Minmize The Video" class="tooltip">&nbsp;</a>';
a.addEventListener("click",cthis.miniMizeVideo);var b=document.getElementById(cthis.videoControlId);b.insertBefore(a,b.firstChild)},createMaxMizeButton:function(){cthis.maxButtonId="videoMaxMize";var a=document.createElement("div");a.id=cthis.maxButtonId;a.innerHTML='<a href="#" title="" data-title="Maxmize The Video" class="tooltip">&nbsp;</a>';a.addEventListener("click",cthis.maxMizeVideo);var b=document.getElementById(cthis.videoContainerId);b.insertBefore(a,b.firstChild)},isVideoFound:function(a,
b){b!=wbUser.id&&(!1==a&&(cthis.isInitiator=!0),cthis.sendMessage("got user media"))},settingsForSecondBrowser:function(){e.fromUser.userid!=wbUser.id&&(cthis.pc=[],cthis.isInitiator=!1,cthis.isChannelReady=!0,cthis.isStarted=!1,cthis.sendMessage("got user media"))},makeInitBrowser:function(){cthis.pc=[];cthis.isStarted=!1;cthis.isInitiator=!0;cthis.isChannelReady=!0;c.utility.beforeSend({videoDefault:!0})},reInitVideo:function(a,b){return a.hasOwnProperty("reinitVideo")&&b!=wbUser.id?(cthis.pc=[],
cthis.isInitiator=!1,cthis.isChannelReady=!0,cthis.isStarted=!1,cthis.sendMessage("got user media"),!0):"object"==typeof cthis&&cthis.hasOwnProperty("pc")&&cthis.hasOwnProperty("pc")&&"undefined"!=typeof cthis.pc[0]&&"disconnected"==cthis.pc[0].iceConnectionState&&"t"==wbUser.role?(cthis.pc=[],cthis.isStarted=!1,cthis.isInitiator=!0,cthis.isChannelReady=!0,c.utility.beforeSend({reinitVideo:!0}),!0):!1}}};g.onbeforeunload=function(){localStorage.removeItem("otherRole");c.utility.userIds=[];cthis.sendMessage("bye");
a.disconnect()};g.isVideoFound=function(a,b){b!=wbUser.id&&(!1==a&&(cthis.isInitiator=!0),cthis.sendMessage("got user media"))}})(window);(function(g){var a=g.whBoard;a.bridge.requestPackets=function(b){1<b.length&&(a.gObj.myArr=b);a.sentReq=!0;return[a.gObj.rcvdPackId,b[0].uid]};a.bridge.makeQueue=function(b){a.gObj.rcvdPackId!=a.gObj.displayedObjId&&(a.gObj.packQueue=a.gObj.packQueue.concat(b.message.repObj))};a.bridge.sendPackets=function(b,c){if(0==b.message.getMsPckt[0])var d=-1;else for(d=0;d<a.gObj.myrepObj.length&&b.message.getMsPckt[0]!=a.gObj.myrepObj[d].uid;d++);for(d+=1;d<b.message.getMsPckt[1];d++)c.push(a.gObj.myrepObj[d]);
return c};a.bridge.handleMissedPackets=function(b,c,d){d=a.bridge.removeDupObjs(d);a.gObj.replayObjs=a.gObj.replayObjs.concat(d);a.bridge.sortingReplyObjs();b!=c&&(localStorage.repObjs=JSON.stringify(a.gObj.replayObjs));a.bridge.containsIfQueuePacks(b,c,a.gObj.displayedObjId,d)};a.bridge.removeDupObjs=function(b){0<a.gObj.myArr.length&&(b[b.length-1].uid==a.gObj.myArr[0].uid&&(a.gObj.myArr[0].hasOwnProperty("cmd")||a.gObj.myArr.shift()),b=b.concat(a.gObj.myArr),a.gObj.myArr=[]);return b};a.bridge.containsIfQueuePacks=
function(b,c,d,f){b!=c&&d+1!=f[0].uid&&0<a.gObj.packQueue.length&&f[f.length-1].uid==a.gObj.packQueue[0].uid&&(a.gObj.packQueue=f.concat(a.gObj.packQueue))};a.bridge.sortingReplyObjs=function(){a.gObj.replayObjs=a.gObj.replayObjs.sort(function(a,c){return a.uid-c.uid})}})(window);(function(g){var a={api:{drag:null,drop:null,elem:null,alter:null,obj:null},dropArea:[],config:{prefix:"dynDiv_",cookie:{expire:"2678400"},regExp:{px:/(\d+)px/,minmax:/dynDiv_minmaxDiv|dynDiv_moveParentDiv/}},cache:{obj:null,elem:null,modus:null,zIndex:null,width:null,height:null,pos:{left:null,top:null},init:{width:null,height:null,pos:{left:null,top:null},offset:null},last:{obj:null,elem:null,mouse:{left:null,top:null}},browser:{support:{page:!1,client:!1}},unloadHandler:null,ie:g.detachEvent?!0:
!1},limit:{min:{left:null,top:null,width:null,height:null},max:{left:null,top:null,width:null,height:null}},divList:[],get:{prefix:{value:function(b,c,d){return a.get.value(b,a.config.prefix+c,d)}},value:function(a,c,d){var f,g="",h=a.length;if(a&&c)for(f=0;f<h;f++)if(d&&0<=a[f].indexOf(c)){g=a[f].split(c)[1];break}else if(a[f]===c){g=a[f];break}return g},pos:function(b){b&&(a.cache.init={width:b.clientWidth,height:b.clientHeight,pos:{left:a.cache.pos.left,top:a.cache.pos.top},offset:a.get.offset.absolute(b)},
a.db(2,!0),a.db(4,a.get.offset.relative(b).left),a.db(5,a.get.offset.relative(b).top))},px:function(b){var c="";b&&b.match(a.config.regExp.px)&&"undefined"!==typeof b.match(a.config.regExp.px)[1]&&(c=b.match(a.config.regExp.px)[1]);return c},mouse:function(b){b&&(a.cache.browser.support.page||a.cache.browser.support.client||(a.cache.browser.support.page=b.pageX||b.pageY?!0:!1,a.cache.browser.support.client=b.clientX||b.clientY?!0:!1),a.cache.browser.support.page?(a.cache.pos.left=b.pageX,a.cache.pos.top=
b.pageY):a.cache.browser.support.client&&(a.cache.pos.left=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.cache.pos.top=b.clientY+document.body.scrollTop+document.documentElement.scrollTop))},offset:{absolute:function(b){var c=0,d=0;if(b)for(c=a.get.offset.relative(b).left,d=a.get.offset.relative(b).top;b.offsetParent;)c+=a.get.offset.relative(b.offsetParent).left,d+=a.get.offset.relative(b.offsetParent).top,b=b.offsetParent;return{left:c,top:d}},relative:function(b){var c=
!1;if(b){var d=c=0,f=a.get.px(a._style(b,"marginLeft")),g=a.get.px(a._style(b,"marginTop")),h=a.get.px(a._style(b,"left")),p=a.get.px(a._style(b,"top")),n=b.offsetLeft,m=b.offsetTop;""!==h&&""!==p&&(n>h+f||m>p+g)&&(c=a.get.px(a._style(b.parentNode,"borderLeft")),d=a.get.px(a._style(b.parentNode,"borderTop")));c={left:0<c?n-c:n,top:0<d?m-d:m}}return c}},parent:function(a,c,d){if(a){for(var f=0;5>f;f++)if(c.test(a.className))if(d)a=a.parentNode;else break;else if(d)break;else a=a.parentNode;return a}},
db:{id:function(b){var c,d={found:!1,data:""},f=a.divList.length;if(b)for(c=0;c<f;c++)if("zIndex"===b)"auto"!==a.divList[c][3]&&a.divList[c][3]>d.data&&(d.found=!0,d.data=a.divList[c][3]);else if(a.divList[c][0]===b){d.found=!0;d.data=c;break}return d}},hit:function(b,c,d){var f=!1;if(b&&c){var g=a.get.offset.absolute(b),h=b.clientWidth,p=b.clientHeight;b=a.get.offset.absolute(c);var p=g.top+p,n=b.top+c.clientHeight,h=g.left+h;c=b.left+c.clientWidth;switch(d){case "fit":case "center":if(g.left>b.left&&
g.left<c&&(g.top>b.top&&g.top<n||p>b.top&&p<n)||h>b.left&&h<c&&(g.top>b.top&&g.top<n||p>b.top&&p<n))f=!0;break;default:g.left>b.left&&g.left<c&&h<c&&g.top>b.top&&g.top<n&&p<n&&(f=!0)}}return f}},on:{move:function(b){if(a.cache.obj){a.get.mouse(b);a.get.db.id("zIndex").found&&a._style(a.cache.obj,"zIndex",a.get.db.id("zIndex").data+1);if(a.cache.modus)switch(a.api.alter&&a.api.alter(),a.cache.modus){case "br":case "tr":case "tl":case "bl":a.resize();break;case "move":case "moveparent":a.move()}a.cache.ie&&
(b.returnValue=!1)}},action:function(){a.cache.obj||(a.set_eventListener(document,"mousemove",a.on.move),a.set_eventListener(document,"mouseup",a.on.stop))},stop:function(){if(a.db(0)&&a.db(6)){var b,c=!1,d=a.dropArea.length;for(b=0;b<d;b++)a.dropArea[b][1]===a.db(6)&&a.get.hit(a.cache.obj,a.dropArea[b][0],a.db(7))&&(c=a.dropArea[b][0]);if(c){b=a.get.offset.absolute(c);switch(a.db(7)){case "fit":a.set.left(a.cache.obj,a.db(4)+(b.left-a.cache.init.offset.left));a.set.top(a.cache.obj,a.db(5)+(b.top-
a.cache.init.offset.top));break;case "center":a.set.left(a.cache.obj,a.db(4)+(b.left-a.cache.init.offset.left)+(c.clientWidth/2-a.cache.obj.clientWidth/2)),a.set.top(a.cache.obj,a.db(5)+(b.top-a.cache.init.offset.top)+(c.clientHeight/2-a.cache.obj.clientHeight/2))}a.db(8,!0)}else a.set.left(a.cache.obj,a.db(4)),a.set.top(a.cache.obj,a.db(5))}a.db(2,!1);a.del_eventListener(document,"mousemove",a.on.move);a.del_eventListener(document,"mouseup",a.on.stop);a._style(a.cache.obj,"zIndex",a.cache.zIndex);
a.cache.last.obj!==a.cache.obj&&(a.cache.last.obj=a.cache.obj);a.cache.last.elem!==a.cache.elem&&(a.cache.last.elem=a.cache.elem);a.db(9)&&a.set.visible(!0);"focus"===a.db(10)&&a.set_eventListener(document,"mousedown",a.on.focus);a.db(4,a.get.offset.relative(a.cache.obj).left);a.db(5,a.get.offset.relative(a.cache.obj).top);a.db(13,a.cache.obj.clientWidth);a.db(14,a.cache.obj.clientHeight);a.api.drop&&a.api.drop();a.limit.min.left=a.limit.min.top=a.limit.min.width=a.limit.min.height=a.limit.min.left=
a.limit.min.top=a.limit.min.width=a.limit.min.height=a.cache.obj=a.cache.modus=a.cache.zIndex=a.cache.elem=!1},focus:function(){"undefined"!==typeof a.divList[a.cache.last.elem]&&("focus"===a.divList[a.cache.last.elem][10]&&a.on.resize(a.cache.last.obj,!1),a.del_eventListener(document,"mousedown",a.on.focus))},unload:function(){a.divList&&a.settings.save()},minmax:function(b){if(b){b=b.target?b.target:b.srcElement;var c=a.get.parent(b,a.config.regExp.minmax,0),c=a.get.prefix.value(c.className.split(" "),
"minmax_Height-",1)||20;b=a.get.parent(b,a.config.regExp.minmax,1);a._style(b,"clip",(new RegExp(c+"\\w+,?\\s?auto","i")).test(a._style(b,"clip"))?"rect(auto auto auto auto)":"rect(auto auto "+c+"px auto)")}},resize:function(b,c){var d;d=b.target||b.srcElement?b.target?b.target:b.srcElement:b;var f=d.className.split(" "),f=a.get.prefix.value(f,"moveParentDiv")&&d.parentNode?d.parentNode.getElementsByTagName("div"):d.getElementsByTagName("div"),g=f.length;for(d=0;d<g;d++)a.get.prefix.value(f[d].className.split(" "),
"resizeDiv_",1)&&a._style(f[d],"visibility",c?"visible":"hidden")}},init:{main:function(){for(var b=0,c=document.getElementsByTagName("div"),d=c.length,f=0;f<d;f++)a.get.prefix.value(c[f].className.split(" "),"",1)&&(a.get.prefix.value(c[f].className.split(" "),"resizeDiv_",1)&&""===a.get.prefix.value(c[f].parentNode.className.split(" "),"move",1)&&a.add(c[f].parentNode,b++,1),a.add(c[f],b++))},action:function(b,c){if(b){b.preventDefault&&b.preventDefault();a.cache.ie&&(b.cancelBubble=!0);b.stopPropagation&&
b.stopPropagation();var d=b.target?b.target:b.srcElement;if(-1===d.className.indexOf("dynDiv_minmaxDiv")){a.get.mouse(b);a.on.action();switch(c){case "move":a.cache.obj=a.api.obj=a.get.parent(d,/dynDiv_moveDiv/);break;case "moveparent":a.cache.obj=a.api.obj=a.get.parent(d,/dynDiv_moveParentDiv/).parentNode;break;case "tl":case "tr":case "bl":case "br":a.cache.obj=a.api.obj=d.parentNode;break;default:a.cache.obj=a.api.obj=d}a.cache.elem=a.api.elem=a.get.db.id(a.cache.obj).data;a.cache.zIndex=a._style(a.cache.obj,
"zIndex");a.get.pos(a.cache.obj);a.cache.modus=c;if(a.db(1)&&a.cache.obj){var d=a.get.offset.absolute(a.cache.obj),f=a.get.offset.absolute(a.db(1));a.limit.min.left=f.left-d.left;a.limit.max.left=a.db(1).clientWidth+f.left-(a.cache.obj.offsetWidth+d.left);a.limit.min.top=f.top-d.top;a.limit.max.top=a.db(1).clientHeight+f.top-(a.cache.obj.offsetHeight+d.top)}a.api.drag&&a.api.drag();switch(c){case "move":case "moveparent":"move"!==a.db(9)&&"move_resize"!==a.db(9)||a.set.visible(!1);break;case "tl":case "tr":case "bl":case "br":"resize"!==
a.db(9)&&"move_resize"!==a.db(9)||a.set.visible(!1)}a.cache.elem===a.cache.last.elem||!a.cache.last.elem&&0!==a.cache.last.elem||a.divList[a.cache.last.elem][10]&&a.on.resize(a.cache.last.obj,!1);"active"!==a.db(10)&&"focus"!==a.db(10)||a.on.resize(a.cache.obj,!0)}}}},settings:{save:function(){if(a.divList){var b,c=a.divList.length;for(b=0;b<c;b++)if(!1!==a.divList[b][12]&&a.divList[b][0].id){var d="",f="",g="",h="";switch(a.divList[b][12]){case "position":d=a.divList[b][4];f=a.divList[b][5];break;
case "size":g=a.divList[b][13];h=a.divList[b][14];break;case "position_size":d=a.divList[b][4],f=a.divList[b][5],g=a.divList[b][13],h=a.divList[b][14]}if(("NaN"!==Number(d)&&"NaN"!==Number(f)||0<g&&0<h)&&navigator.cookieEnabled){var p=new Date;p.setSeconds((new Date).setTime(p.getSeconds())+Number(a.config.cookie.expire));document.cookie="ByRei_dynDiv_"+a.divList[b][0].id+"="+d+"_"+f+"_"+g+"_"+h+"; expires="+p.toGMTString()}}}},load:function(a){var c=!1;if(navigator.cookieEnabled&&a){var d=document.cookie;
/; /.test(d)?d=d.split("; "):/, /.test(d)&&(d=d.split(", "));if(d){var f,g=d.length;for(f=0;f<g;f++)if(d[f]&&/ByRei_dynDiv/.test(d[f])){var h=/ByRei_dynDiv_(\w+)=(\d*)\_(\d*)\_(\d*)\_(\d*)/.exec(d[f]);if("undefined"!==typeof h&&null!==h&&"undefined"!==typeof h[1]&&h[1]===a){c={left:h[2],top:h[3],width:h[4],height:h[5]};break}}}}return c}},set:{visible:function(b){var c,d=a.divList.length;for(c=0;c<d;c++)a.divList[c]!==a.divList[a.cache.elem]&&a._style(a.divList[c][0],"visibility",b?"visible":"hidden")},
left:function(b,c){a._style(b,"left",c+"px")},top:function(b,c){a._style(b,"top",c+"px")},width:function(b,c){a._style(b,"width",c+"px")},height:function(b,c){a._style(b,"height",c+"px")}},resize:function(){if(a.cache.obj&&a.cache.modus){var b=0,c=0,d=a.db(4),f=a.db(5),g=a.db(11),h=!1,p=a.cache.pos.left-a.cache.init.pos.left||0,n=a.cache.pos.top-a.cache.init.pos.top||0;if(g){switch(a.cache.modus){case "br":case "tl":p=n*g;break;case "bl":case "tr":p=n*g*-1}if(a.cache.last.mouse.left===a.cache.pos.left||
a.cache.last.mouse.top===a.cache.pos.top)h=!0;a.cache.last.mouse.left=a.cache.pos.left;a.cache.last.mouse.top=a.cache.pos.top}switch(a.cache.modus){case "br":case "tr":b=a.cache.init.width+p;break;case "tl":case "bl":b=a.cache.init.width-p}switch(a.cache.modus){case "br":case "bl":c=a.cache.init.height+n;break;case "tr":case "tl":c=a.cache.init.height-n}switch(a.cache.modus){case "tl":f=a.db(5)+n;d=a.db(4)+p;break;case "tr":f=a.db(5)+n;break;case "bl":d=a.db(4)+p}if(a.db(1)){p=a.cache.pos.left-a.cache.init.pos.left;
n=a.cache.pos.top-a.cache.init.pos.top;switch(a.cache.modus){case "tl":case "bl":p<a.limit.min.left&&(g||(b=a.cache.init.width-a.limit.min.left,d=a.db(4)+a.limit.min.left),h=!0);break;case "tr":case "br":p>a.limit.max.left&&(g||(b=a.cache.init.width+a.limit.max.left),h=!0)}switch(a.cache.modus){case "tl":case "tr":n<a.limit.min.top&&(g||(c=a.cache.init.height-a.limit.min.top,f=a.db(5)+a.limit.min.top),h=!0);break;case "bl":case "br":n>a.limit.max.top&&(g||(c=a.cache.init.height+a.limit.max.top),h=
!0)}}g?!h&&20<b&&20<c&&(a.set.width(a.cache.obj,b),a.set.height(a.cache.obj,c),a.set.left(a.cache.obj,d),a.set.top(a.cache.obj,f)):(20<b&&(a.set.width(a.cache.obj,b),a.set.left(a.cache.obj,d)),20<c&&(a.set.height(a.cache.obj,c),a.set.top(a.cache.obj,f)))}},move:function(){if(a.cache.obj){var b=a.cache.pos.left-(a.cache.init.pos.left-a.db(4)),c=a.cache.pos.top-(a.cache.init.pos.top-a.db(5));if(a.db(1)){var d=a.cache.pos.left-a.cache.init.pos.left,f=a.cache.pos.top-a.cache.init.pos.top;d<a.limit.min.left?
b=a.db(4)+a.limit.min.left:d>a.limit.max.left&&(b=a.db(4)+a.limit.max.left);f<a.limit.min.top?c=a.db(5)+a.limit.min.top:f>a.limit.max.top&&(c=a.db(5)+a.limit.max.top)}isNaN(b)||a.set.left(a.cache.obj,b);isNaN(c)||a.set.top(a.cache.obj,c)}},db:function(b,c){var d=!1;0<=a.cache.elem&&a.divList[a.cache.elem]&&"undefined"!==typeof a.divList[a.cache.elem][b]&&("undefined"!==typeof c?(a.divList[a.cache.elem][b]=c,d=!0):d=a.divList[a.cache.elem][b]);return d},add:function(b,c,d){if(b){var f="auto",k=b.className.split(" "),
h=function(b,c){return a._style(b,"zIndex")||a._style(b,"zIndex",c)};if(a.get.prefix.value(k,"",1)||d){var p=null,n=!1,m=!1,l=!1,r=!1,s=!1,q=!1,t=a.get.prefix.value(k,"",1),u=b.parentNode;if(t)switch(t){case "moveDiv":a._style(b,"cursor","move");a.set_eventListener(b,"mousedown",function(b){a.init.action(b,"move")});f=h(b,c);break;case "moveParentDiv":a._style(b,"cursor","move");a.set_eventListener(b,"mousedown",function(b){a.init.action(b,"moveparent")});b=b.parentNode;f=h(b,c);break;case "resizeDiv_tl":a._style(b,
"cursor","nw-resize");a.set_eventListener(b,"mousedown",function(b){a.init.action(b,"tl")});break;case "resizeDiv_tr":a._style(b,"cursor","ne-resize");a.set_eventListener(b,"mousedown",function(b){a.init.action(b,"tr")});break;case "resizeDiv_bl":a._style(b,"cursor","sw-resize");a.set_eventListener(b,"mousedown",function(b){a.init.action(b,"bl")});break;case "resizeDiv_br":a._style(b,"cursor","se-resize");a.set_eventListener(b,"mousedown",function(b){a.init.action(b,"br")});break;case "minmaxDiv":a._style(b,
"cursor","pointer");a.set_eventListener(b,"mousedown",function(b){a.on.minmax(b)});break;case "dropArea":a.dropArea.push([b,"global"])}for(a.get.prefix.value(k,"dropArea-",1)&&a.dropArea.push([b,a.get.prefix.value(k,"dropArea-",1)]);u;){if(u.className&&a.get.prefix.value(u.className.split(" "),"setLimit")){b!==u&&(p=u);break}u=u.parentNode}p||!a.get.prefix.value(k,"bodyLimit")&&!a.get.prefix.value(b.parentNode.className.split(" "),"bodyLimit")||(p=document.body);a.get.prefix.value(k,"dropLimit")?
n="global":a.get.prefix.value(k,"dropLimit-",1)&&(n=a.get.prefix.value(k,"dropLimit-",1));a.get.prefix.value(k,"dropMode-",1)&&(m=a.get.prefix.value(k,"dropMode-",1));a.get.prefix.value(k,"hideMove")&&a.get.prefix.value(k,"hideResize")?l="move_resize":a.get.prefix.value(k,"hideMove")?l="move":a.get.prefix.value(k,"hideResize")&&(l="resize");a.get.prefix.value(k,"keepAspect")&&b.clientWidth&&b.clientHeight&&(s=Math.abs(b.clientWidth/b.clientHeight));a.get.prefix.value(k,"showResize-",1)&&(r=a.get.prefix.value(k,
"showResize-",1),a.on.resize(b,!1),"dbclick"===r&&a.set_eventListener(b,"dblclick",function(b){a.on.resize(b,!0)}));switch(a.get.prefix.value(k,"saveSettings-",1)){case "position":q="position";break;case "size":q="size";break;case "position_size":q="position_size"}q&&!a.cache.unloadHandler&&(a.cache.unloadHandler=a.set_eventListener(g,"unload",a.on.unload));a.get.prefix.value(k,"loadSettings")&&(c=a.settings.load(b.id))&&("NaN"!==Number(c.left)&&"NaN"!==Number(c.top)&&(a.set.left(b,c.left),a.set.top(b,
c.top)),0<c.width&&0<c.height&&(a.set.width(b,c.width),a.set.height(b,c.height)));if(a.get.prefix.value(k,"moveParentDiv")||a.get.prefix.value(k,"moveDiv")||d)a.get.db.id(b).found||a.divList.push([b,p,!1,f,a.get.offset.relative(b).left,a.get.offset.relative(b).top,n,m,!1,l,r,s,q,b.clientWidth,b.clientHeight])}}},_style:function(a,c,d){if(a&&c&&a.style&&"undefined"!==typeof a.style[c])if(d)try{return a.style[c]=d}catch(f){return!1}else return""===a.style[c]?a.currentStyle?a.currentStyle[c]:g.getComputedStyle?
g.getComputedStyle(a,"").getPropertyValue(c):!1:a.style[c]},del_eventListener:function(b,c,d){b&&c&&d&&(a.cache.ie?b.detachEvent("on"+c,d):b.removeEventListener(c,d,!1))},set_eventListener:function(b,c,d){if(b&&c&&d)return a.cache.ie?b.attachEvent("on"+c,d):b.addEventListener(c,d,!1)}};a.set_eventListener(g,"load",a.init.main)})(window);var optimization=function(g,a){return{socket:g,time:a,sendPacketWithOptimization:function(a,c,d){"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),whBoard.sentPackets+=a.length,1==c&&io.send(JSON.parse(a)),whBoard.utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=d&&(whBoard.sentPackets+=a.length,1==c&&io.send(JSON.parse(a)),whBoard.utility.updateSentInformation(a,!0),this.lastarrowtime=(new Date).getTime())}}};
vcan.doOptiMize=function(g){if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),g.detail.hasOwnProperty("cevent")||vcan.calculatePackets(lastmousemovetime,"m",g.clientX-vcan.main.offset.x,g.clientY-vcan.main.offset.y);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),g.detail.hasOwnProperty("cevent")||vcan.calculatePackets(lastmousemovetime,"m",g.clientX-vcan.main.offset.x,g.clientY-vcan.main.offset.y),
vcan.calculatePackets(lastmousemovetime,"m",g.clientX-vcan.main.offset.x,g.clientY-vcan.main.offset.y),lastmousemovetime=(new Date).getTime())};vcan.calculatePackets=function(g,a,b,c){g=vcan.makeStackObj(g,a,b,c);whBoard.uid++;g.uid=whBoard.uid;vcan.main.replayObjs.push(g);whBoard.utility.beforeSend({repObj:[g]});localStorage.repObjs=JSON.stringify(vcan.main.replayObjs);whBoard.utility.updateSentPackets(g)};(function(g){whBoard.response={reclaimRole:function(a,b){if(a!=b){whBoard.utility.removeToolBox();whBoard.utility.makeCanvasDisable();"undefined"!=typeof localStorage.teacherId&&localStorage.removeItem("teacherId");whBoard.utility.uniqueArrOfObjsToStudent();whBoard.view.disappearBox("Canvas");whBoard.view.disappearBox("drawArea");var c=document.getElementById("vcanvas");c.className=c.className.replace(/\bteacher\b/," ");c.className="student";localStorage.setItem("canvasDrwMsg",!0);whBoard.utility.chkValueInLocalStorage("orginialTeacherId")||
whBoard.utility.setCommandToolHeights(d,"decrement")}else{if(whBoard.utility.chkValueInLocalStorage("orginialTeacherId")){var d=localStorage.getItem("toolHeight");whBoard.utility.setCommandToolHeights(d,"increment")}whBoard.utility.uniqueArrOfObjsToTeacher();c=document.getElementById("vcanvas");c.className=c.className.replace(/\bstudent\b/," ");c.className="teacher";localStorage.canvasDrwMsg=!0;whBoard.utility.setStyleUserConnetion("coff","con")}},assignRole:function(a,b,c,d){a!=b?(whBoard.socketOn=
parseInt(c),whBoard.utility.setClass("vcanvas","socketon"),whBoard.utility.assignRole(b),whBoard.utility.uniqueArrOfObjsToTeacher(),whBoard.utility.chkValueInLocalStorage("canvasDrwMsg")||(g.whBoard.view.canvasDrawMsg("Canvas"),g.whBoard.view.drawLabel("drawArea"),localStorage.setItem("canvasDrwMsg",!0)),a=document.getElementById("vcanvas"),a.className=a.className.replace(/\bstudent\b/," "),a.className="teacher",whBoard.user.connected=!0,d=localStorage.getItem("toolHeight"),whBoard.utility.setCommandToolHeights(d,
"increment"),whBoard.utility.setStyleUserConnetion("coff","con","fromAssign")):(whBoard.utility.uniqueArrOfObjsToStudent(),whBoard.utility.chkValueInLocalStorage("orginalTeacherId")||(a=document.getElementById("vcanvas"),a.className=a.className.replace(/\bteacher\b/," "),a.className="student"),null==localStorage.getItem("orginialTeacherId")&&whBoard.utility.setCommandToolHeights(d,"decrement"),localStorage.setItem("canvasDrwMsg",!0))},videoInit:function(a,b){a!=b&&(whBoard.videoAdd?whBoard.utility.beforeSend({foundVideo:!0,
fromUser:a}):whBoard.utility.beforeSend({foundVideo:!1}))},foundVideo:function(a,b){a?g.isVideoFound(!0,b):g.isVideoFound(!1,b)},checkUser:function(a,b,c){var d=a.message.joinId;whBoard.joinUserId=d;var f=whBoard.utility.existUserLikeMe(a);a.fromUser.userid==b&&a.fromUser.userid==d?setTimeout(function(){if(f=whBoard.utility.existUserLikeMe(a)){var b=document.getElementById("containerWb");b.parentNode.removeChild(b);alert("Either Teacher Or Student is already existed, \nIt's also possible there other role is passing");
io.disconnect();return"disconnect"}whBoard.utility.shareVideoInformation(a,c);whBoard.utility.makeUserAvailable(a.message.checkUser.e.clientLen);whBoard.user.connected&&!whBoard.drawMode&&whBoard.utility.makeCanvasEnable()},1E3):whBoard.utility.makeUserAvailable(a.message.checkUser.e.clientLen)},createPeer:function(a,b,c){whBoard.gObj.video.currBrowser=a;whBoard.gObj.video.peerBrowser=b;whBoard.gObj.video.currBrowser==c?"undefined"==typeof oneExecuted&&(oneExecuted=!0,whBoard.utility.beforeSend({isChannelReady:!0}),
whBoard.gObj.video.init(!0),whBoard.gObj.video.toUser=whBoard.gObj.video.peerBrowser):cthis.isStarted=!1},video:function(a,b,c){"undefined"!=typeof whBoard.gObj.video&&("bye"==c?a!=b&&whBoard.gObj.video.videoOnMsg(c,a):whBoard.gObj.video.videoOnMsg(c,a))},clearAll:function(a,b,c,d){a!=b&&(whBoard.tool=new whBoard.tool_obj("t_clearall"),whBoard.utility.t_clearallInit(),whBoard.utility.makeDefaultValue());d&&whBoard.utility.updateRcvdInformation(c)},replayAll:function(){g.whBoard.vcan.main.replayObjs=
whBoard.gObj.replayObjs;whBoard.utility.clearAll(!1);whBoard.toolInit("t_replay","fromFile")},createArrow:function(a,b){var c=whBoard.arrImg,d={};d.mp={x:a.x,y:a.y};whBoard.utility.drawArrowImg(c,d);b&&whBoard.utility.updateRcvdInformation(a)},replayObj:function(a){g.whBoard.vcan.main.replayObjs=[];0<a.length&&whBoard.gObj.displayedObjId+1==a[0].uid&&(g.whBoard.vcan.main.replayObjs=a,whBoard.toolInit("t_replay","fromBrowser",!0,whBoard.utility.dispQueuePacket))},chunk:function(a,b,c){whBoard.bridge.handleMissedPackets(a,
b,c)},repObjForMissedPkts:function(a){(0!=whBoard.gObj.rcvdPackId||0<whBoard.uid&&0==whBoard.gObj.rcvdPackId)&&("object"==typeof a||a instanceof Array)&&a[0].hasOwnProperty("uid")&&whBoard.gObj.rcvdPackId+1!=a[0].uid&&!a.hasOwnProperty("chunk")&&Number(whBoard.gObj.rcvdPackId)<Number(a[0].uid)&&(a=whBoard.bridge.requestPackets(a),whBoard.utility.beforeSend({getMsPckt:a}))}}})(window);
